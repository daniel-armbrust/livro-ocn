<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Guia Prático para Implantação de Aplicações Cloud Native na Oracle Cloud Infrastructure (OCI)."><meta name=author content="Daniel Armbrust (darmbrust@gmail.com)"><link href=https://ocn.dev.br/capitulo-6/funcoes/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.22"><title>Capítulo 8: CaaS e FaaS - OCN - Oracle Cloud Native</title><link rel=stylesheet href=../../assets/stylesheets/main.84d31ad4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i%7CRed+Hat+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Open Sans";--md-code-font:"Red Hat Mono"}</style><link rel=stylesheet href=../../css/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=deep-orange> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#capitulo-8-caas-e-faas class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="OCN - Oracle Cloud Native" class="md-header__button md-logo" aria-label="OCN - Oracle Cloud Native" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> OCN - Oracle Cloud Native </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Capítulo 8: CaaS e FaaS </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=deep-orange aria-label="Light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=deep-purple aria-label="Dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <div class=md-header__source> <a href=https://github.com/daniel-armbrust/livro-ocn title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="OCN - Oracle Cloud Native" class="md-nav__button md-logo" aria-label="OCN - Oracle Cloud Native" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> OCN - Oracle Cloud Native </label> <div class=md-nav__source> <a href=https://github.com/daniel-armbrust/livro-ocn title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../prefacio/ class=md-nav__link> <span class=md-ellipsis> Prefácio </span> </a> </li> <li class=md-nav__item> <a href=../../sobre-o-autor/ class=md-nav__link> <span class=md-ellipsis> Sobre o Autor </span> </a> </li> <li class=md-nav__item> <a href=../../como-usar-este-livro/ class=md-nav__link> <span class=md-ellipsis> Como usar este Livro </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-1/ class=md-nav__link> <span class=md-ellipsis> Capítulo 1 - Introdução à Computação em Nuvem </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-2/ class=md-nav__link> <span class=md-ellipsis> Capítulo 2 - Aplicação OCI PIZZA </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-3/ class=md-nav__link> <span class=md-ellipsis> Capítulo 3 - OCI Foundations </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-4/ class=md-nav__link> <span class=md-ellipsis> Capítulo 4 - Serviços Auxiliares e Persistência de Dados </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-5/ class=md-nav__link> <span class=md-ellipsis> Capítulo 5 - Conectividade e Redes </span> </a> </li> <li class=md-nav__item> <a href=../ class=md-nav__link> <span class=md-ellipsis> Capítulo 6 - Contêineres, Docker e Funções </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-7/ class=md-nav__link> <span class=md-ellipsis> Capítulo 7 - Publicando a Aplicação na Web </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-8/ class=md-nav__link> <span class=md-ellipsis> Capítulo 8 - Oracle Kubernetes Engine (OKE) </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-9/ class=md-nav__link> <span class=md-ellipsis> Capítulo 9 - Serviço DevOps </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-10/ class=md-nav__link> <span class=md-ellipsis> Capítulo 10 - Monitoração e Observabilidade </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-11/ class=md-nav__link> <span class=md-ellipsis> Capítulo 11 - Infraestrutura como Código (IaC) </span> </a> </li> <li class=md-nav__item> <a href=../../apendice-a/ class=md-nav__link> <span class=md-ellipsis> Apêndice A - OCI HOWTOs </span> </a> </li> <li class=md-nav__item> <a href=../../bibliografia/ class=md-nav__link> <span class=md-ellipsis> Bibliografia </span> </a> </li> <li class=md-nav__item> <a href=../../changelog/ class=md-nav__link> <span class=md-ellipsis> ChangeLog </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc hidden> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=capitulo-8-caas-e-faas>Capítulo 8: CaaS e FaaS</h1> <h1 id=84-functions>8.4 Functions</h1> <p><a href=https://docs.oracle.com/en-us/iaas/Content/Functions/Concepts/functionsoverview.htm>Oracle Functions</a>, ou simplesmente <a href=https://docs.oracle.com/en-us/iaas/Content/Functions/Concepts/functionsoverview.htm>Functions</a>, é uma plataforma <em>serverless</em> que possibilita a criação e execução de códigos na infraestrutura do OCI, sem a necessidade de provisionar, configurar ou gerenciar servidores.</p> <p><em>Serverless</em> é um termo que se refere a um modelo de computação em nuvem onde o gerenciamento da infraestrutura do servidor é abstraído do desenvolvedor. Embora o nome possa sugerir a ausência de servidores, na verdade, eles estão presentes, mas a sua administração é completamente gerenciada pelo provedor de nuvem. Isso permite que os desenvolvedores se concentrem na lógica de suas aplicações, sem se preocupar com a infraestrutura subjacente.</p> <p>Em vez de precisar criar e configurar servidores, você simplesmente faz o deployment do seu código e o OCI se encarrega de provisionar a infraestrutura necessária para executar a sua aplicação. Isso inclui também a escalabilidade automática dos recursos utilizados, garantindo que sua aplicação possa se adaptar às variações de demanda sem a necessidade de intervenção manual.</p> <p>O serviço OCI Functions é baseado no projeto de código aberto <a href=https://fnproject.io/ >Fn Project</a>, que oferece uma plataforma de <em>Função como Serviço (FaaS - Function as a Service)</em> para o desenvolvimento e execução de aplicações serverless. A escolha em usar um projeto de código aberto é evitar o <em>vendor lock-in</em>, comum em outras plataformas serverless. Aplicações desenvolvidas usando o Fn Project não estão sujeitas a esse lock-in, permitindo que sejam executadas localmente ou em qualquer outro provedor de nuvem.</p> <p><img alt=alt_text src=../img/oci-functions-2.png title="Fn Project"></p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Os termos BaaS (Backend as a Service) ou FaaS (Function as a Service), também são usados para descrever este modelo computacional.</p> </div> <p>Embora o conceito de serverless possa parecer a solução mágica e definitiva para a construção de aplicações, ele não é uma <em>"bala de prata"</em> que se aplica a todos os casos. Veremos que existem algumas limitações e seu uso exige uma nova abordagem na forma como as aplicações são desenvolvidas.</p> <h2 id=841-funcoes-em-conteineres>8.4.1 Funções em Contêineres</h2> <p>Uma <a href=https://docs.oracle.com/en-us/iaas/Content/Functions/Concepts/functionsoverview.htm>função</a> é, essencialmente, um contêiner que é executado na infraestrutura do OCI, seja por meio de uma chamada direta ou em resposta a um evento específico. O processo de construção da imagem do contêiner e seu envio para o <a href=https://docs.oracle.com/en-us/iaas/Content/Registry/home.htm>OCIR</a> permanece o mesmo; no entanto, é realizado de maneira diferente, utilizando a ferramenta de linha de comando fornecida pelo Fn Project.</p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Por ser um contêiner, é possível criar seu próprio Dockerfile do zero em um processo conhecido como Bring-Your-Own-Dockerfile (BYOD). Para mais informações, consulte <a href=https://docs.oracle.com/en-us/iaas/Content/Functions/Tasks/functionsusingcustomdockerfiles.htm#Using_Custom_Docker_Files>"Using Custom Dockerfiles"</a>.</p> </div> <p>As funções que você cria devem ser projetadas para executar uma única tarefa de forma simples e eficiente. O serviço não é destinado à execução de grandes aplicações e sim, pequenas tarefas, como, por exemplo, realizar um processamento de dados simples e, ao final, enviar um e-mail.</p> <p>Aqui, já encontramos uma limitação em relação ao código que será executado como uma função: o tempo total de execução e a quantidade de memória disponível para que a função realize a sua tarefa.</p> <p>Ao criar uma função, é obrigatório informar o <em>"tempo máximo de vida do contêiner"</em> como também, a quantidade máxima de memória que ele pode utilizar. O tempo máximo de execução pode ser configurado entre <em>30 segundos</em> até no máximo <em>300 segundos (5 minutos)</em>. Em relação à memória, é possível alocar no minímo <em>128 MB</em> e no máximo <em>3072 MB (3 GB)</em>.</p> <p>Isso significa que, se a execução da função ultrapassar o tempo máximo especificado, o OCI encerrará a função. Da mesma forma, se a função exigir mais memória do que a alocada, o OCI também encerrará a função. </p> <p>Outra limitação importante é a <em>quantidade máxima de dados</em> que podem ser enviados para a função, bem como a quantidade máxima de dados que ela pode retornar. Esses limites são fixos em <em>6 MB</em> e não podem ser alterados.</p> <p>Essas limitações também se refletem na forma como o serviço é cobrado. A cobrança é baseada no tempo em que a função permanece ativa e na quantidade de memória alocada. Por exemplo, ao calcular rapidamente o custo do serviço para <em>200 chamadas por dia</em>, totalizando <em>6.200 chamadas por mês</em> (200 * 31 = 6.200), com um tempo de execução de <em>300 segundos</em> e utilização de <em>256 MB de memória</em>, o custo mensal seria de <em>R$ 5,08</em>.</p> <p><img alt=alt_text src=../img/oci-functions-1.png title="OCI Functions - Estimated Monthly Cost"></p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Sempre verifique o custo do serviço atráves do link <a href=https://www.oracle.com/cloud/costestimator.html>OCI Cost Estimator</a> para obter valores atualizados.</p> </div> <p>É fundamental entender a tecnologia para projetar de forma eficaz o que pode ser transformado em uma função ou o que é mais apropriado para essa finalidade. Neste capítulo, utilizaremos como exemplo duas funcionalidades da aplicação OCI Pizza que utilizam o OCI Functions para enviar e-mails aos usuários finais.</p> <h2 id=842-cold-start-e-hot-start>8.4.2 Cold Start e Hot Start</h2> <p>Como já mencionado, uma função é essencialmente um contêiner que é executado pelo OCI. Essa execução pode ser realizada por meio do utilitário de linha de comando fornecido pelo Fn Project, OCI CLI, SDKs, chamadas HTTP diretas ou em resposta a eventos configuráveis.</p> <p>Toda execução de aplicações conteinerizadas segue o mesmo processo de deployment. Primeiramente, a imagem do contêiner é baixada do registro de imagens (OCIR) e, em seguida, é executada por uma infraestrutura que suporte a execução de contêineres por exemplo, <a href=./docs/chapter-5/container-instances.md>Container Instances</a> ou <a href=./docs/chapter-6/intro.md>OKE</a>. </p> <p>O tempo total do processo de deployment, desde a inicialização até a disponibilização da função para processar a requisição é denominado <strong>Cold Start</strong>.</p> <p><strong>Cold Start</strong> é o termo utilizado em ambientes de computação serverless que se refere ao atraso inicial que ocorre quando uma função é invocado pela primeira vez ou após um período de inatividade <em>(idle time)</em>. Em outras palavras, é o tempo total que o provedor de nuvem leva para disponibilizar a função e, em seguida, executar o seu código.</p> <p><img alt=alt_text src=../img/oci-functions-3.png title="OCI Functions - Cold Start"></p> <p>Uma função que foi criada e permanece inativa por um certo período, é encerrada pelo OCI. Se ela for invocada novamente, o período de <em>cold start</em> se reinicia para essa função. </p> <p>O período de <em>cold start</em> não pode ser ajustado e é imprevisível, o que significa que não é possível estimar com precisão o tempo que o OCI levará para disponibilizar a função para uso. Essa é uma das características do serviço que deve ser levada em conta ao se projetar funções. </p> <p>Já o termo <strong>Hot Start</strong> tem um significado oposto. Quando uma função ainda está ativa ou, se a infraestrutura de execução estiver <em>"de pé"</em>, as requisições para essa função geralmente apresentam um tempo de resposta inferior a um segundo, pois não é necessário realizar todo o processo de deploy nesse caso.</p> <p>É importante dizer que, requisições subsequentes são direcionadas ao mesmo contêiner. Se necessário, o OCI escala automaticamente a infraestrutura de forma horizontal para atender a um maior volume de requisições, até um limite máximo de <em>60 GB de memória</em> para execução de todas as funções. Esse é o limite do tenancy, e, se necessário, é possível solicitar uma alteração para aumentar a capacidade máxima de memória.</p> <h2 id=843-provisioned-concurrency>8.4.3 Provisioned Concurrency</h2> <p>Uma maneira de garantir que as funções estejam prontas para uso e evitar o cold start é utilizar o recurso <em><a href=https://docs.oracle.com/en-us/iaas/Content/Functions/Tasks/functionsusingprovisionedconcurrency.htm#functionsusingprovisionedconcurrency>Provisioned Concurrency</a></em>. Essa funcionalidade assegura que a infraestrutura de execução permaneça disponível para um número mínimo de invocações simultâneas, permitindo que as funções sejam acionadas rapidamente.</p> <p>Provisioned Concurrency é medido em <em>"provisioned concurrency units" (PCUs)</em>. Você determina a quantidade de PCUs com base no número de invocações concorrentes que você espera para a função. Ao especificar PCUs, a infraestrutura de execução da função se torna dedicada a você e está sempre disponível. No entanto, essa disponibilidade contínua resulta em um custo mais elevado.</p> <p><img alt=alt_text src=../img/oci-functions-4.png title="OCI Functions - PCUs Cost"></p> <p>Para a aplicação OCI Pizza, não será definido nenhum valor para Provisioned Concurrency, uma vez que as funções da aplicação podem tolerar o cold start. Para mais informações sobre o assunto, consulte <em><a href=https://docs.oracle.com/en-us/iaas/Content/Functions/Tasks/functionsusingprovisionedconcurrency.htm#functionsusingprovisionedconcurrency>"Reducing Initial Latency Using Provisioned Concurrency"</a></em>.</p> <h2 id=844-criando-funcoes>8.4.4 Criando Funções</h2> <p>Agora que a teoria e as limitações do uso de funções foram abordadas, é hora de aplicar esse conhecimento na prática e preparar o ambiente para o desenvolvimento de funções.</p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>O passo a passo para a instalação do Fn Project e a preparação do ambiente é baseado no documento <a href=https://docs.oracle.com/en-us/iaas/Content/Functions/Tasks/functionsquickstartlocalhost.htm#functionsquickstartlocalhost>"Functions QuickStart on Local Host"</a>.</p> </div> <h3 id=instalacao-do-fn-project><strong>Instalação do Fn Project</strong></h3> <p>Primeiramente, na sua máquina local, deve-se instalar o Fn Project através do comando abaixo:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1>1</a></span>
<span class=normal><a href=#__codelineno-0-2>2</a></span>
<span class=normal><a href=#__codelineno-0-3>3</a></span>
<span class=normal><a href=#__codelineno-0-4>4</a></span>
<span class=normal><a href=#__codelineno-0-5>5</a></span>
<span class=normal><a href=#__codelineno-0-6>6</a></span>
<span class=normal><a href=#__codelineno-0-7>7</a></span>
<span class=normal><a href=#__codelineno-0-8>8</a></span>
<span class=normal><a href=#__codelineno-0-9>9</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1></a>$<span class=w> </span>curl<span class=w> </span>-LSs<span class=w> </span>https://raw.githubusercontent.com/fnproject/cli/master/install<span class=w> </span><span class=p>|</span><span class=w> </span>sh
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2></a><span class=o>[</span>sudo<span class=o>]</span><span class=w> </span>password<span class=w> </span><span class=k>for</span><span class=w> </span>darmbrust:
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3></a>fn<span class=w> </span>version<span class=w> </span><span class=m>0</span>.6.36
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4></a>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5></a><span class=w>        </span>______
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6></a><span class=w>       </span>/<span class=w> </span>____/___
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7></a><span class=w>      </span>/<span class=w> </span>/_<span class=w>  </span>/<span class=w> </span>__<span class=w> </span><span class=se>\</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8></a><span class=w>     </span>/<span class=w> </span>__/<span class=w> </span>/<span class=w> </span>/<span class=w> </span>/<span class=w> </span>/
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9></a><span class=w>    </span>/_/<span class=w>   </span>/_/<span class=w> </span>/_/<span class=sb>`</span>
</span></code></pre></div></td></tr></table></div> <p>Uma forma de verificar se a instalação foi concluída com sucesso é através do comando <em><a href=https://github.com/fnproject/docs/tree/master/cli>fn</a></em> que acaba de ser instalado:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-1-1>1</a></span>
<span class=normal><a href=#__codelineno-1-2>2</a></span>
<span class=normal><a href=#__codelineno-1-3>3</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1></a>$<span class=w> </span>fn<span class=w> </span>version
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2></a>Client<span class=w> </span>version<span class=w> </span>is<span class=w> </span>latest<span class=w> </span>version:<span class=w> </span><span class=m>0</span>.6.36
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3></a>Server<span class=w> </span>version:<span class=w>  </span>?
</span></code></pre></div></td></tr></table></div> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Para mais informações sobre a instalação do Fn Project, consulte <a href=https://fnproject.io/tutorials/install/ >Fn Installation</a>.</p> </div> <h3 id=function-application><strong>Function Application</strong></h3> <p>Toda função antes de ser criada, deve fazer parte de um <em><a href=https://docs.oracle.com/en-us/iaas/Content/Functions/Concepts/functionsconcepts.htm#applications>Application</a></em>, que serve como um meio de agrupar funções com configurações comuns no OCI.</p> <p>As funções dentro de um mesmo Application compartilham a mesma sub-rede, utilizam as mesmas variáveis de ambiente e a mesma arquitetura de processador, possuem configurações de log em comum e são executadas de forma isolada em relação a outras Applications.</p> <p>A aplicação OCI Pizza utiliza um Application por região para agrupar suas funções, que será criada especificando a sub-rede privada (subnprv) e algumas variáveis de ambiente necessárias.</p> <p>O comando abaixo cria a Application na região <em>Brazil East (São Paulo)</em>:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-2-1> 1</a></span>
<span class=normal><a href=#__codelineno-2-2> 2</a></span>
<span class=normal><a href=#__codelineno-2-3> 3</a></span>
<span class=normal><a href=#__codelineno-2-4> 4</a></span>
<span class=normal><a href=#__codelineno-2-5> 5</a></span>
<span class=normal><a href=#__codelineno-2-6> 6</a></span>
<span class=normal><a href=#__codelineno-2-7> 7</a></span>
<span class=normal><a href=#__codelineno-2-8> 8</a></span>
<span class=normal><a href=#__codelineno-2-9> 9</a></span>
<span class=normal><a href=#__codelineno-2-10>10</a></span>
<span class=normal><a href=#__codelineno-2-11>11</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1></a>$<span class=w> </span>oci<span class=w> </span>--region<span class=w> </span><span class=s2>&quot;sa-saopaulo-1&quot;</span><span class=w> </span>fn<span class=w> </span>application<span class=w> </span>create<span class=w> </span><span class=se>\</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2></a>&gt;<span class=w> </span>--compartment-id<span class=w> </span><span class=s2>&quot;ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3></a>&gt;<span class=w> </span>--display-name<span class=w> </span><span class=s2>&quot;fn-appl-ocipizza&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4></a>&gt;<span class=w> </span>--subnet-ids<span class=w> </span><span class=s2>&quot;[\&quot;ocid1.subnet.oc1.sa-saopaulo-1.aaaaaaaaaaaaaaaabbbbbbbbccc\&quot;]&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5></a>&gt;<span class=w> </span>--config<span class=w> </span><span class=s2>&quot;{ </span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6></a><span class=s2>&gt;     \&quot;OCI_REGION\&quot;: \&quot;sa-saopaulo-1\&quot;,</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7></a><span class=s2>&gt;     \&quot;ENV\&quot;: \&quot;prd\&quot;,    </span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8></a><span class=s2>&gt;     \&quot;NOSQL_COMPARTMENT_OCID\&quot;: \&quot;ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc\&quot;,</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9></a><span class=s2>&gt;     \&quot;EMAIL_COMPARTMENT_OCID\&quot;: \&quot;ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc\&quot;}&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10></a>&gt;<span class=w> </span>--shape<span class=w> </span><span class=s2>&quot;GENERIC_X86&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11></a>&gt;<span class=w> </span>--wait-for-state<span class=w> </span><span class=s2>&quot;ACTIVE&quot;</span>
</span></code></pre></div></td></tr></table></div> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>A sub-rede utilizada deve ter pelo menos um determinado número mínimo de endereços IP livres para uso do OCI Functions. Consulte <a href=https://docs.oracle.com/en-us/iaas/Content/Functions/Tasks/functionscidrblocks.htm>CIDR Blocks and OCI Functions</a> para maiores detalhes.</p> </div> <h3 id=habilitando-a-captura-dos-logs><strong>Habilitando a captura dos Logs</strong></h3> <p>Toda função, ao ser executada, gera logs. Para facilitar a análise de possíveis problemas que possam impedir a execução correta da função, é uma boa prática habilitar o registro desses logs.</p> <p>Para habilitar os logs de execução das funções, primeiro é necessário obter o OCID do <a href=https://docs.oracle.com/en-us/iaas/Content/Logging/Task/managinglogs.htm>Log Group</a> que foi criado na seção do Capítulo 1</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-3-1>1</a></span>
<span class=normal><a href=#__codelineno-3-2>2</a></span>
<span class=normal><a href=#__codelineno-3-3>3</a></span>
<span class=normal><a href=#__codelineno-3-4>4</a></span>
<span class=normal><a href=#__codelineno-3-5>5</a></span>
<span class=normal><a href=#__codelineno-3-6>6</a></span>
<span class=normal><a href=#__codelineno-3-7>7</a></span>
<span class=normal><a href=#__codelineno-3-8>8</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1></a>$<span class=w> </span>oci<span class=w> </span>--region<span class=w> </span><span class=s2>&quot;sa-saopaulo-1&quot;</span><span class=w> </span>logging<span class=w> </span>log-group<span class=w> </span>list<span class=w> </span><span class=se>\</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2></a>&gt;<span class=w> </span>--compartment-id<span class=w> </span><span class=s2>&quot;ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3></a>&gt;<span class=w> </span>--all<span class=w> </span><span class=se>\</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4></a>&gt;<span class=w> </span>--display-name<span class=w> </span><span class=s2>&quot;ocipizza-loggroup&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5></a>&gt;<span class=w> </span>--query<span class=w> </span><span class=s1>&#39;data[].id&#39;</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6></a><span class=o>[</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7></a><span class=w>  </span><span class=s2>&quot;ocid1.loggroup.oc1.sa-saopaulo-1.aaaaaaaaaaaaaaaabbbbbbbbccc&quot;</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8></a><span class=o>]</span>
</span></code></pre></div></td></tr></table></div> <p>Em seguida, obtenha o OCID do Application:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-4-1>1</a></span>
<span class=normal><a href=#__codelineno-4-2>2</a></span>
<span class=normal><a href=#__codelineno-4-3>3</a></span>
<span class=normal><a href=#__codelineno-4-4>4</a></span>
<span class=normal><a href=#__codelineno-4-5>5</a></span>
<span class=normal><a href=#__codelineno-4-6>6</a></span>
<span class=normal><a href=#__codelineno-4-7>7</a></span>
<span class=normal><a href=#__codelineno-4-8>8</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1></a>$<span class=w> </span>oci<span class=w> </span>--region<span class=w> </span><span class=s2>&quot;sa-saopaulo-1&quot;</span><span class=w> </span>fn<span class=w> </span>application<span class=w> </span>list<span class=w> </span><span class=se>\</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2></a>&gt;<span class=w> </span>--compartment-id<span class=w> </span><span class=s2>&quot;ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3></a>&gt;<span class=w> </span>--display-name<span class=w> </span><span class=s2>&quot;fn-appl-ocipizza&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4></a>&gt;<span class=w> </span>--lifecycle-state<span class=w> </span><span class=s2>&quot;ACTIVE&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5></a>&gt;<span class=w> </span>--query<span class=w> </span><span class=s1>&#39;data[].id&#39;</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6></a><span class=o>[</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7></a><span class=w>  </span><span class=s2>&quot;ocid1.fnapp.oc1.sa-saopaulo-1.aaaaaaaaaaaaaaaabbbbbbbbccc&quot;</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8></a><span class=o>]</span>
</span></code></pre></div></td></tr></table></div> <p>Com essas informações, já é possível habilitar os logs para a execução das funções:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-5-1> 1</a></span>
<span class=normal><a href=#__codelineno-5-2> 2</a></span>
<span class=normal><a href=#__codelineno-5-3> 3</a></span>
<span class=normal><a href=#__codelineno-5-4> 4</a></span>
<span class=normal><a href=#__codelineno-5-5> 5</a></span>
<span class=normal><a href=#__codelineno-5-6> 6</a></span>
<span class=normal><a href=#__codelineno-5-7> 7</a></span>
<span class=normal><a href=#__codelineno-5-8> 8</a></span>
<span class=normal><a href=#__codelineno-5-9> 9</a></span>
<span class=normal><a href=#__codelineno-5-10>10</a></span>
<span class=normal><a href=#__codelineno-5-11>11</a></span>
<span class=normal><a href=#__codelineno-5-12>12</a></span>
<span class=normal><a href=#__codelineno-5-13>13</a></span>
<span class=normal><a href=#__codelineno-5-14>14</a></span>
<span class=normal><a href=#__codelineno-5-15>15</a></span>
<span class=normal><a href=#__codelineno-5-16>16</a></span>
<span class=normal><a href=#__codelineno-5-17>17</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1></a>$<span class=w> </span>oci<span class=w> </span>--region<span class=w> </span><span class=s2>&quot;sa-saopaulo-1&quot;</span><span class=w> </span>logging<span class=w> </span>log<span class=w> </span>create<span class=w> </span><span class=se>\</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2></a>&gt;<span class=w> </span>--log-group-id<span class=w> </span><span class=s2>&quot;ocid1.loggroup.oc1.sa-saopaulo-1.aaaaaaaaaaaaaaaabbbbbbbbccc&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3></a>&gt;<span class=w> </span>--display-name<span class=w> </span><span class=s2>&quot;log-service-fn&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4></a>&gt;<span class=w> </span>--log-type<span class=w> </span><span class=s2>&quot;SERVICE&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5></a>&gt;<span class=w> </span>--retention-duration<span class=w> </span><span class=m>30</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6></a>&gt;<span class=w> </span>--is-enabled<span class=w> </span><span class=s2>&quot;true&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7></a>&gt;<span class=w> </span>--configuration<span class=w> </span><span class=s2>&quot;{</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8></a><span class=s2>&gt;     \&quot;archiving\&quot;: {</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9></a><span class=s2>&gt;         \&quot;isEnabled\&quot;: false</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10></a><span class=s2>&gt;     },</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11></a><span class=s2>&gt;     \&quot;compartmentId\&quot;: \&quot;ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc\&quot;,</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12></a><span class=s2>&gt;     \&quot;source\&quot;: {</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13></a><span class=s2>&gt;         \&quot;category\&quot;: \&quot;invoke\&quot;,</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14></a><span class=s2>&gt;         \&quot;resource\&quot;: \&quot;ocid1.fnapp.oc1.sa-saopaulo-1.aaaaaaaaaaaaaaaabbbbbbbbccc\&quot;,</span>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15></a><span class=s2>&gt;         \&quot;service\&quot;: \&quot;functions\&quot;,</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16></a><span class=s2>&gt;         \&quot;sourceType\&quot;: \&quot;OCISERVICE\&quot;}}&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17></a>&gt;<span class=w> </span>--wait-for-state<span class=w> </span><span class=s2>&quot;SUCCEEDED&quot;</span>
</span></code></pre></div></td></tr></table></div> <h3 id=configuracoes-iniciais-do-fn-project><strong>Configurações iniciais do Fn Project</strong></h3> <p>Antes de construir funções é necessário configurar o Fn Project de acordo com alguns parametrôs do OCI.</p> <ol> <li>Criar um contexto de utilização especificando o parâmetro <em>--provider oracle</em>:</li> </ol> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-6-1>1</a></span>
<span class=normal><a href=#__codelineno-6-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1></a>$<span class=w> </span>fn<span class=w> </span>create<span class=w> </span>context<span class=w> </span>ocipizza-ctx<span class=w> </span>--provider<span class=w> </span>oracle
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2></a>Successfully<span class=w> </span>created<span class=w> </span>context:<span class=w> </span>ocipizza-ctx
</span></code></pre></div></td></tr></table></div> <ol> <li>Após, utilize o <em><a href=https://github.com/fnproject/docs/blob/master/cli/ref/fn-create-context.md>contexto</a></em> que foi recentemente criado:</li> </ol> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-7-1>1</a></span>
<span class=normal><a href=#__codelineno-7-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1></a>$<span class=w> </span>fn<span class=w> </span>use<span class=w> </span>context<span class=w> </span>ocipizza-ctx
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2></a>Now<span class=w> </span>using<span class=w> </span>context:<span class=w> </span>ocipizza-ctx
</span></code></pre></div></td></tr></table></div> <ol> <li>Atualize o contexto com as informações referentes ao OCID do compartimento onde as funções serão implantadas, ao OCID do compartimento que armazena as imagens de contêiner (serviço OCIR), à URL da região para o endpoint das funções e à URL do repositório de imagens para onde as imagens serão enviadas (push) e baixadas (pull): </li> </ol> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-8-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1></a>$<span class=w> </span>fn<span class=w> </span>update<span class=w> </span>context<span class=w> </span>oracle.compartment-id<span class=w> </span>ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc
</span></code></pre></div></td></tr></table></div> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-9-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1></a>$<span class=w> </span>fn<span class=w> </span>update<span class=w> </span>context<span class=w> </span>oracle.image-compartment-id<span class=w> </span>ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc
</span></code></pre></div></td></tr></table></div> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-10-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1></a>$<span class=w> </span>fn<span class=w> </span>update<span class=w> </span>context<span class=w> </span>api-url<span class=w> </span>https://functions.sa-saopaulo-1.oci.oraclecloud.com
</span></code></pre></div></td></tr></table></div> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-11-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1></a>$<span class=w> </span>fn<span class=w> </span>update<span class=w> </span>context<span class=w> </span>registry<span class=w> </span>gru.ocir.io/grxmw2a9myyj/fn-repo
</span></code></pre></div></td></tr></table></div> <ol> <li>Por fim, é necessário fazer login no serviço OCIR da região:</li> </ol> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-12-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1></a>$<span class=w> </span>docker<span class=w> </span>login<span class=w> </span>-u<span class=w> </span><span class=s1>&#39;grxmw2a9myyj/darmbrust@gmail.com&#39;</span><span class=w> </span>gru.ocir.io
</span></code></pre></div></td></tr></table></div> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Para obter mais informações sobre os comandos utilizados, consulte <a href=https://docs.oracle.com/en-us/iaas/Content/Functions/Tasks/functionsquickstartlocalhost.htm#functionsquickstartlocalhost>Functions QuickStart on Local Host</a>.</p> </div> <h3 id=funcoes-da-aplicacao-oci-pizza><strong>Funções da aplicação OCI Pizza</strong></h3> <p>Existem duas funções localizadas no diretório <em>"services/"</em> que são utilizadas pela aplicação OCI Pizza:</p> <ul> <li> <p><strong>fn-user-registry-email</strong></p> <ul> <li>Função destinada a registrar um novo usuário. </li> <li>Após o usuário submeter seus dados de cadastro, a função insere essas informações no banco de dados e, em seguida, envia um e-mail ao usuário para confirmar e efetivar o seu cadastro.</li> </ul> </li> <li> <p><strong>fn-password-recovery-email</strong></p> <ul> <li>Função destinada para recuperação de senha do usuário.</li> <li>Essa função será executada para gerar um link de recuperação de senha, que será enviado ao usuário por e-mail.</li> </ul> </li> </ul> <p>Ambas as fuções, após o seu devido processamento, utilizam o serviço <a href=../chapter-3/email-delivery.md>Email Delivery</a> para enviar um e-mail ao usuário.</p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Aqui, apresentarei os detalhes sobre como criar uma função, utilizando como exemplo a função "fn-password-recovery-email". Os mesmos comandos devem ser aplicados à função "fn-user-registry-email" para que a aplicação OCI Pizza funcione por completo.</p> </div> <p>Depois de todo o ambiente local do <em><a href=https://fnproject.io/ >Fn Project</a></em> estar configurado, a função é criada utilizando o comando <em><a href=https://github.com/fnproject/docs/blob/master/cli/ref/fn-init.md>fn init</a></em>:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-13-1>1</a></span>
<span class=normal><a href=#__codelineno-13-2>2</a></span>
<span class=normal><a href=#__codelineno-13-3>3</a></span>
<span class=normal><a href=#__codelineno-13-4>4</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1></a>$<span class=w> </span>fn<span class=w> </span>init<span class=w> </span>--runtime<span class=w> </span>python3.8<span class=w> </span>--memory<span class=w> </span><span class=m>256</span><span class=w> </span>--timeout<span class=w> </span><span class=m>120</span><span class=w> </span>fn-password-recovery-email
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2></a>Creating<span class=w> </span><span class=k>function</span><span class=w> </span>at:<span class=w> </span>./fn-password-recovery-email
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3></a>Function<span class=w> </span>boilerplate<span class=w> </span>generated.
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4></a>func.yaml<span class=w> </span>created.
</span></code></pre></div></td></tr></table></div> <p>Note que, no comando acima, além de definir a <em>memória alocada (--memory)</em> e o <em>tempo máximo de execução (--timeout)</em>, é obrigatório especificar o <em>ambiente de execução</em> responsável por executar o código da função <em>(--runtime)</em>. Para a aplicação OCI Pizza, todo o código foi desenvolvido na linguagem de programação Python, versão 3.8 <em>(python3.8)</em>.</p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>OCI Functions oferece suporte a diversas linguagens de programação. Para verificar se a sua linguagem de programação é suportada, consulte o link <a href=https://docs.oracle.com/en-us/iaas/Content/Functions/Tasks/languagessupportedbyfunctions.htm#functionssupportedlanguageversions_topic_Language_versions_supported_by_FDKs>"Languages Supported by OCI Functions"</a>.</p> </div> <p>O comando <em>fn init</em> cria o diretório <em>"fn-password-recovery-email/"</em> com três arquivos:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-14-1>1</a></span>
<span class=normal><a href=#__codelineno-14-2>2</a></span>
<span class=normal><a href=#__codelineno-14-3>3</a></span>
<span class=normal><a href=#__codelineno-14-4>4</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1></a>$<span class=w> </span>ls<span class=w> </span>-1<span class=w> </span>fn-password-recovery-email/
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2></a>func.py
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3></a>func.yaml
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4></a>requirements.txt
</span></code></pre></div></td></tr></table></div> <ul> <li> <p><strong>func.py</strong></p> <ul> <li>Arquivo principal e o primeiro a ser chamado quando a função é invocada.</li> </ul> </li> <li> <p><strong>func.yaml</strong></p> <ul> <li>Arquivo de configuração da função que contém informações essenciais para sua execução. </li> </ul> </li> <li> <p><strong>requirements.txt</strong></p> <ul> <li>Arquito que contém a lista de depêndencias Python necessárias para executar a função.</li> </ul> </li> </ul> <p>Por ser um contêiner, a função permite a criação de diretórios, a adição de pacotes extras e o desenvolvimento de bibliotecas específicas, entre outras personalizações. No entanto, é importante notar que quanto maior o tamanho da função, mais tempo será necessário para o seu deployment. Além disso, quanto mais funcionalidades forem incorporadas, maior será a demanda de memória durante a execução da função.</p> <p>A função <em>fn-password-recovery-email</em> apresenta a seguinte estrutura de arquivos e diretórios:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-15-1> 1</a></span>
<span class=normal><a href=#__codelineno-15-2> 2</a></span>
<span class=normal><a href=#__codelineno-15-3> 3</a></span>
<span class=normal><a href=#__codelineno-15-4> 4</a></span>
<span class=normal><a href=#__codelineno-15-5> 5</a></span>
<span class=normal><a href=#__codelineno-15-6> 6</a></span>
<span class=normal><a href=#__codelineno-15-7> 7</a></span>
<span class=normal><a href=#__codelineno-15-8> 8</a></span>
<span class=normal><a href=#__codelineno-15-9> 9</a></span>
<span class=normal><a href=#__codelineno-15-10>10</a></span>
<span class=normal><a href=#__codelineno-15-11>11</a></span>
<span class=normal><a href=#__codelineno-15-12>12</a></span>
<span class=normal><a href=#__codelineno-15-13>13</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1></a>$<span class=w> </span>tree<span class=w> </span>.
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2></a>.
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3></a>├──<span class=w> </span>func.py
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4></a>├──<span class=w> </span>func.yaml
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5></a>├──<span class=w> </span>modules
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6></a>│<span class=w>   </span>├──<span class=w> </span>__init__.py
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7></a>│<span class=w>   </span>├──<span class=w> </span>email.py
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8></a>│<span class=w>   </span>├──<span class=w> </span>nosql.py
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9></a>│<span class=w>   </span>├──<span class=w> </span>user.py
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10></a>│<span class=w>   </span>└──<span class=w> </span>utils.py
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11></a>└──<span class=w> </span>requirements.txt
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12></a>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13></a><span class=m>1</span><span class=w> </span>directory,<span class=w> </span><span class=m>8</span><span class=w> </span>files
</span></code></pre></div></td></tr></table></div> <h3 id=build-e-push><strong>Build e Push</strong></h3> <p>Para construir a imagem da função, dentro do diretório <em>"fn-password-recovery-email/"</em> e execute o comando <em><a href=https://github.com/fnproject/docs/blob/master/cli/ref/fn-build.md>fn build</a></em>:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-16-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1></a>$<span class=w> </span>fn<span class=w> </span>-v<span class=w> </span>build
</span></code></pre></div></td></tr></table></div> <p>Por fim, é necessário enviar a imagem para o OCIR utilizando o comando <em><a href=https://github.com/fnproject/docs/blob/master/cli/ref/fn-push.md>fn push</a></em>:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-17-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1></a>$<span class=w> </span>fn<span class=w> </span>-v<span class=w> </span>push
</span></code></pre></div></td></tr></table></div> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>O comando <a href=https://github.com/fnproject/docs/blob/master/cli/ref/fn-deploy.md>fn deploy</a> combina a execução dos comandos <a href=https://github.com/fnproject/docs/blob/master/cli/ref/fn-build.md>fn build</a> e <a href=https://github.com/fnproject/docs/blob/master/cli/ref/fn-push.md>fn push</a>. Além de realizar essas operações simultaneamente, ele também atualiza a versão da função para cada nova execução.</p> </div> <h3 id=criando-a-funcao-no-oci><strong>Criando a função no OCI</strong></h3> <p>Uma vez que a imagem da função está disponível no OCIR, o próximo passo é criar a função no OCI. Para isso, é necessário especificar a quantidade de memória a ser alocada, o tempo máximo de execução e a URL completa da imagem correspondente à região onde a função será executada:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-18-1>1</a></span>
<span class=normal><a href=#__codelineno-18-2>2</a></span>
<span class=normal><a href=#__codelineno-18-3>3</a></span>
<span class=normal><a href=#__codelineno-18-4>4</a></span>
<span class=normal><a href=#__codelineno-18-5>5</a></span>
<span class=normal><a href=#__codelineno-18-6>6</a></span>
<span class=normal><a href=#__codelineno-18-7>7</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1></a>$<span class=w> </span>oci<span class=w> </span>--region<span class=w> </span><span class=s2>&quot;sa-saopaulo-1&quot;</span><span class=w> </span>fn<span class=w> </span><span class=k>function</span><span class=w> </span>create<span class=w> </span><span class=se>\</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2></a>&gt;<span class=w> </span>--application-id<span class=w> </span><span class=s2>&quot;ocid1.fnapp.oc1.sa-saopaulo-1.aaaaaaaaaaaaaaaabbbbbbbbccc&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3></a>&gt;<span class=w> </span>--display-name<span class=w> </span><span class=s2>&quot;fn-password-recovery-email&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4></a>&gt;<span class=w> </span>--memory-in-mbs<span class=w> </span><span class=m>256</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5></a>&gt;<span class=w> </span>--timeout-in-seconds<span class=w> </span><span class=m>120</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6></a>&gt;<span class=w> </span>--image<span class=w> </span><span class=s2>&quot;gru.ocir.io/grxmw2a9myyj/fn-repo/fn-password-recovery-email:0.0.1&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7></a>&gt;<span class=w> </span>--wait-for-state<span class=w> </span><span class=s2>&quot;ACTIVE&quot;</span>
</span></code></pre></div></td></tr></table></div> <h3 id=executando-a-funcao><strong>Executando a Função</strong></h3> <p>Existem diferentes maneiras de executar uma função que já foi criada e configurada no OCI. São elas:</p> <ul> <li> <p>Utilizando o comando <em><a href=https://docs.oracle.com/en-us/iaas/Content/Functions/Tasks/functionsinvokingfunctions.htm#usingfncli>fn invoke</a></em>.</p> </li> <li> <p>Por meio do OCI CLI.</p> </li> <li> <p>Por meio dos SDKs do OCI.</p> </li> <li> <p>Por meio de uma chamada HTTP assinada.</p> </li> </ul> <p>Os métodos <em>fn invoke</em>, <em>OCI CLI</em> e <em>SDKs</em> constroem automaticamente a requisição para se comunicar com as APIs do OCI. Por outro lado, ao utilizar o método <em>"HTTP assinado"</em>, você precisará criar manualmente a requisição que será enviada às APIs do OCI. Isso inclui a geração de uma assinatura válida e a inclusão do respectivo OCID do compartimento onde a função está localizada. Essas informações devem ser inseridas no cabeçalho HTTP que será utilizado para chamar a função.</p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Consulte <a href=https://docs.oracle.com/en-us/iaas/Content/Functions/Tasks/functionsinvokingfunctions.htm#Invoking_Functions>"Invoking Functions"</a> para obter mais informações sobre os diferentes métodos de execução de uma função.</p> </div> <p>Aqui, será usado o comando <em>fn invoke</em> para chamar a função <em>"fn-password-recovery-email"</em>:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-19-1>1</a></span>
<span class=normal><a href=#__codelineno-19-2>2</a></span>
<span class=normal><a href=#__codelineno-19-3>3</a></span>
<span class=normal><a href=#__codelineno-19-4>4</a></span>
<span class=normal><a href=#__codelineno-19-5>5</a></span>
<span class=normal><a href=#__codelineno-19-6>6</a></span>
<span class=normal><a href=#__codelineno-19-7>7</a></span>
<span class=normal><a href=#__codelineno-19-8>8</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1></a>$<span class=w> </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s1>&#39;{&quot;email&quot;: &quot;darmbrust@gmail.com&quot;}&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>fn<span class=w> </span>invoke<span class=w> </span>fn-appl-ocipizza<span class=w> </span>fn-password-recovery-email<span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span>.
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2></a><span class=o>{</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3></a><span class=w>  </span><span class=s2>&quot;status&quot;</span>:<span class=w> </span><span class=s2>&quot;success&quot;</span>,
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4></a><span class=w>  </span><span class=s2>&quot;message&quot;</span>:<span class=w> </span><span class=s2>&quot;E-mail for password recovery sent successfully.&quot;</span>,
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5></a><span class=w>  </span><span class=s2>&quot;data&quot;</span>:<span class=w> </span><span class=o>{</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6></a><span class=w>    </span><span class=s2>&quot;email&quot;</span>:<span class=w> </span><span class=s2>&quot;darmbrust@gmail.com&quot;</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7></a><span class=w>  </span><span class=o>}</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8></a><span class=o>}</span>
</span></code></pre></div></td></tr></table></div> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>O comando <a href=https://jqlang.github.io/jq/ >jq</a>, usado no final da linha de comando, não é necessário. Ele foi utilizado apenas para formatar a resposta retornada da função, tornando-a mais legível.</p> </div> <p>Um último detalhe a ser observado sobre o tempo de <em>cold start</em>: utilizando o utilitário de linha de comando <em><a href=https://www.man7.org/linux/man-pages/man1/time.1.html>time</a></em>, é possível verificar que a primeira execução da função levou quase <em>16 segundos</em> para completar. Esse foi o tempo total que o OCI levou para preparar a função, incluindo o tempo necessário para a execução do código e o tempo do <em>fn invoke</em>.</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-20-1>1</a></span>
<span class=normal><a href=#__codelineno-20-2>2</a></span>
<span class=normal><a href=#__codelineno-20-3>3</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1></a>real<span class=w>    </span>0m15.932s
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2></a>user<span class=w>    </span>0m0.118s
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3></a>sys<span class=w>     </span>0m0.056s
</span></code></pre></div></td></tr></table></div> <p>Na segunda execução, com a infraestrutura ainda ativa <em>(hot start)</em>, o tempo total foi de aproximadamente <em>1 segundo</em>:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-21-1>1</a></span>
<span class=normal><a href=#__codelineno-21-2>2</a></span>
<span class=normal><a href=#__codelineno-21-3>3</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1></a>real<span class=w>    </span>0m1.010s
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2></a>user<span class=w>    </span>0m0.092s
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3></a>sys<span class=w>     </span>0m0.062s
</span></code></pre></div></td></tr></table></div> <p>É importante lembrar que o período de <em>cold start</em> é imprevisível, e esses valores podem variar, podendo ser maiores ou menores.</p> <h3 id=exibindo-os-logs-de-execucao><strong>Exibindo os logs de execução</strong></h3> <p>Para verificar os logs relacionados à execução da função, recomendo consultar o Console da Web. Essa opção facilita a aplicação de filtros e proporciona uma visualização mais intuitiva das informações.</p> <p><img alt=alt_text src=../img/oci-functions-5.png title="OCI Functions - Logs"></p> <p>A sintaxe para visualizar os logs por meio do OCI CLI é mais complexa e geralmente é utilizada quando se deseja enviar os logs para processamento em outra aplicação. De qualquer forma, aqui está um exemplo de comando:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-22-1>1</a></span>
<span class=normal><a href=#__codelineno-22-2>2</a></span>
<span class=normal><a href=#__codelineno-22-3>3</a></span>
<span class=normal><a href=#__codelineno-22-4>4</a></span>
<span class=normal><a href=#__codelineno-22-5>5</a></span>
<span class=normal><a href=#__codelineno-22-6>6</a></span>
<span class=normal><a href=#__codelineno-22-7>7</a></span>
<span class=normal><a href=#__codelineno-22-8>8</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1></a>$<span class=w> </span>oci<span class=w> </span>--region<span class=w> </span><span class=s2>&quot;sa-saopaulo-1&quot;</span><span class=w> </span>logging-search<span class=w> </span>search-logs<span class=w> </span><span class=se>\</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2></a>&gt;<span class=w> </span>--search-query<span class=w> </span><span class=s2>&quot;search</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3></a><span class=s2>&gt;     \&quot;ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc/ocid1.loggroup.oc1.sa-saopaulo-1.aaaaaaaaaaaaaaaabbbbbbbbccc/ocid1.log.oc1.sa-saopaulo-1.aaaaaaaaaaaaaaaabbbbbbbbccc\&quot;</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4></a><span class=s2>&gt;     | sort by datetime desc&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5></a>&gt;<span class=w> </span>--time-start<span class=w> </span><span class=s2>&quot;2025-01-15T13:20:52.684Z&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6></a>&gt;<span class=w> </span>--time-end<span class=w> </span><span class=s2>&quot;2025-01-15T14:20:52.684Z&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7></a>&gt;<span class=w> </span>--is-return-field-info<span class=w> </span><span class=nb>false</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8></a>&gt;<span class=w> </span>--limit<span class=w> </span><span class=m>2</span>
</span></code></pre></div></td></tr></table></div> <p>Lembre-se de que o horário em que o OCI registra as informações é em UTC. No exemplo acima, o comando <em>fn invoke</em> foi executado às 10:20:52 no meu horário local (GMT-3).</p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Consulte <a href=https://docs.oracle.com/en-us/iaas/Content/Logging/Reference/query_language_specification.htm>Logging Query Language Specification</a> para obter mais informações sobre a sintaxe utilizada pelo OCI para consultar logs.</p> </div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 Daniel Armbrust. Todos os direitos reservados. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://www.linkedin.com/in/daniel-armbrust/ target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.path", "navigation.indexes", "navigation.top"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.f55a23d4.min.js></script> </body> </html>