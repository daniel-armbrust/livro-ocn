<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Guia Prático para Implantação de Aplicações Cloud Native na Oracle Cloud Infrastructure (OCI)."><meta name=author content="Daniel Armbrust (darmbrust@gmail.com)"><link href=https://ocn.dev.br/capitulo-8/arquitetura-do-kubernetes/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.22"><title>Capítulo 9: Oracle Kubernetes Engine (OKE) - OCN - Oracle Cloud Native</title><link rel=stylesheet href=../../assets/stylesheets/main.84d31ad4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i%7CRed+Hat+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Open Sans";--md-code-font:"Red Hat Mono"}</style><link rel=stylesheet href=../../css/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=deep-orange> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#capitulo-9-oracle-kubernetes-engine-oke class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="OCN - Oracle Cloud Native" class="md-header__button md-logo" aria-label="OCN - Oracle Cloud Native" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> OCN - Oracle Cloud Native </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Capítulo 9: Oracle Kubernetes Engine (OKE) </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=deep-orange aria-label="Light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=deep-purple aria-label="Dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <div class=md-header__source> <a href=https://github.com/daniel-armbrust/livro-ocn title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="OCN - Oracle Cloud Native" class="md-nav__button md-logo" aria-label="OCN - Oracle Cloud Native" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> OCN - Oracle Cloud Native </label> <div class=md-nav__source> <a href=https://github.com/daniel-armbrust/livro-ocn title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../prefacio/ class=md-nav__link> <span class=md-ellipsis> Prefácio </span> </a> </li> <li class=md-nav__item> <a href=../../sobre-o-autor/ class=md-nav__link> <span class=md-ellipsis> Sobre o Autor </span> </a> </li> <li class=md-nav__item> <a href=../../como-usar-este-livro/ class=md-nav__link> <span class=md-ellipsis> Como usar este Livro </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-1/ class=md-nav__link> <span class=md-ellipsis> Capítulo 1 - Introdução à Computação em Nuvem </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-2/ class=md-nav__link> <span class=md-ellipsis> Capítulo 2 - Aplicação OCI PIZZA </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-3/ class=md-nav__link> <span class=md-ellipsis> Capítulo 3 - OCI Foundations </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-4/ class=md-nav__link> <span class=md-ellipsis> Capítulo 4 - Serviços Auxiliares e Persistência de Dados </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-5/ class=md-nav__link> <span class=md-ellipsis> Capítulo 5 - Conectividade e Redes </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-6/ class=md-nav__link> <span class=md-ellipsis> Capítulo 6 - Contêineres, Docker e Funções </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-7/ class=md-nav__link> <span class=md-ellipsis> Capítulo 7 - Publicando a Aplicação na Web </span> </a> </li> <li class=md-nav__item> <a href=../ class=md-nav__link> <span class=md-ellipsis> Capítulo 8 - Oracle Kubernetes Engine (OKE) </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-9/ class=md-nav__link> <span class=md-ellipsis> Capítulo 9 - Serviço DevOps </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-10/ class=md-nav__link> <span class=md-ellipsis> Capítulo 10 - Monitoração e Observabilidade </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-11/ class=md-nav__link> <span class=md-ellipsis> Capítulo 11 - Infraestrutura como Código (IaC) </span> </a> </li> <li class=md-nav__item> <a href=../../apendice-a/ class=md-nav__link> <span class=md-ellipsis> Apêndice A - OCI HOWTOs </span> </a> </li> <li class=md-nav__item> <a href=../../bibliografia/ class=md-nav__link> <span class=md-ellipsis> Bibliografia </span> </a> </li> <li class=md-nav__item> <a href=../../changelog/ class=md-nav__link> <span class=md-ellipsis> ChangeLog </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc hidden> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=capitulo-9-oracle-kubernetes-engine-oke>Capítulo 9: Oracle Kubernetes Engine (OKE)</h1> <h1 id=93-arquitetura-do-kubernetes>9.3 Arquitetura do Kubernetes</h1> <p>O Kubernetes é composto por diversos componentes distribuídos e independentes, cada um com sua própria responsabilidade. A maioria deles foi desenvolvida na <em><a href=https://go.dev/ >linguagem de programação Go</a></em> e muitos fazem parte da <em><a href=../../capitulo-1/cloud-native/ >Cloud Native Computing Foundation (CNCF)</a></em>.</p> <p>Para que um cluster Kubernetes funcione corretamente, é necessário instalar e configurar todos esses componentes que serão detalhados a seguir.</p> <p><img alt=alt_text src=../img/golang-kubernetes-logo-1.png title="Golang + Kubernetes"></p> <p>Além de detalhar os componentes, será apresentada a arquitetura geral do Kubernetes e a forma como esses componentes interagem entre si.</p> <p>Para facilitar a identificação, a equipe de desenvolvimento do Kubernetes utiliza o prefixo <strong><em>kube</em></strong> na maioria dos componentes e utilitários que fazem parte do projeto. A exceção a essa convenção são duas dependências externas: o <strong><em><a href=https://kubernetes.io/docs/setup/production-environment/container-runtimes/ >Container Runtime</a></em></strong> e o <strong><em><a href=https://etcd.io/ >etcd</a></em></strong>.</p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Aqui, são apresentados alguns termos e objetos do Kubernetes, como <em>Pods, Services e Deployments</em>. Não se preocupe, pois os detalhes de cada um deles e o seu funcionamento serão explorados na seção <em><a href=../objetos-kubernetes/ >8.5 Objetos Kubernetes</a></em>.</p> </div> <h2 id=931-master-nodes-e-worker-nodes>9.3.1 Master Nodes e Worker Nodes</h2> <p>Um cluster Kubernetes típico é composto por várias máquinas, que podem ser físicas, virtuais ou uma combinação de ambas, conhecidas como <em>Nodes</em>. Esses <em>nodes</em> são organizados em dois grupos principais:</p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>É importante ressaltar que, embora seja possível executar todos os componentes do Kubernetes em uma única máquina, essa configuração não oferece tolerância a falhas. A abordagem recomendada é ter pelo menos duas máquinas configuradas como <em>Master Nodes</em> e outras duas como <em>Worker Nodes</em>. Essa configuração proporciona maior resiliência e disponibilidade.</p> </div> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>As máquinas do <em>Master Nodes</em> deve ser <em>Linux</em>. Já as máquinas dos <em>Worker Nodes</em> podem ser <em>Linux</em> ou <em>Windows</em>.</p> </div> <p><img alt=alt_text src=../img/kubernetes-master-worker-nodes-1.png title="Master Nodes e Worker Nodes"></p> <h3 id=control-plane-ou-master-nodes><strong>Control Plane ou Master Nodes</strong></h3> <p>Esse grupo de máquinas supervisiona e envia tarefas para os <em>Worker Nodes</em>. Ou seja, elas são responsáveis por manter o <em>"estado desejado do cluster"</em>.</p> <p>Toda a inteligência do Kubernetes está concentrada nos <em>Master Nodes</em>, e cada cluster deve ter pelo menos uma máquina designada para desempenhar essa função.</p> <p>Há uma coleção de serviços que operam continuamente em cada <em>Master Nodes</em>, responsáveis por manter o estado do cluster, incluindo:</p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>A documentação de todos os componentes do Kubernetes está disponível no link <em><a href=https://kubernetes.io/docs/concepts/overview/components/#core-components>"Core Components"</a></em>.</p> </div> <h4 id=kube-apiserver><a href=https://kubernetes.io/docs/concepts/architecture/#kube-apiserver>kube-apiserver</a></h4> <p>O <em><a href=https://kubernetes.io/docs/concepts/architecture/#kube-apiserver>kube-apiserver</a></em> é o <em>frontend</em> do Kubernetes, atuando como o <em>"ponto de administração"</em> que permite aos usuários enviar comandos e consultar informações sobre o cluster. </p> <p>Esse componente expõe uma <em>API RESTful via HTTPS</em>, que, por padrão, <em>"escuta"</em> as requisições na porta <strong><em>6443/TCP</em></strong>. Essa API permite que os usuários gerenciem, monitorem e obtenham informações sobre todo o cluster, através do utilitário de linha de comando <strong><em><a href=https://kubernetes.io/docs/reference/kubectl/ >kubectl</a></em></strong>.</p> <p><img alt=alt_text src=../img/kube-apiserver-1.gif title=kube-apiserver></p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Devido ao fato de o <em><a href=https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/ >kube-apiserver</a></em> ser uma <em>API RESTful</em>, é possível interagir com ele utilizando até mesmo o utilitário de linha de comando <em><a href=https://curl.se/ >curl</a></em>. No entanto, é mais prático e fácil realizar essas interações através do <em><a href=https://kubernetes.io/docs/reference/kubectl/ >kubectl</a></em>.</p> </div> <p>Uma outra função desse componente, é realizar cosultas periódicas ao banco de dados <em><a href=https://etcd.io/ >etcd</a></em>.</p> <h4 id=etcd><strong><a href=https://etcd.io/ >etcd</a></strong></h4> <p>Todos os comandos enviados pelo <em><a href=https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/ >kube-apiserver</a></em>, especialmente aqueles que alteram o <strong><em>"estado do cluster"</em></strong>, são persistidos ou atualizados em um banco de dados chave/valor distribuído nos <em>Master Nodes</em> conhecido como <em><a href=https://etcd.io/ >etcd</a></em>.</p> <p>A principal função do <em>etcd</em> é armazenar de maneira persistente todas as alterações que foram enviadas ao <em><a href=https://kubernetes.io/docs/concepts/architecture/#kube-apiserver>kube-apiserver</a></em>. O Kubernetes consulta periodicamente o <em><a href=https://etcd.io/ >etcd</a></em> para verificar se o <strong><em>"estado do cluster"</em></strong> está em conformidade com os dados ali armazenados.</p> <p><img alt=alt_text src=../img/etcd-1.gif title=etcd></p> <p>Outro ponto importante é que nenhum componente pode ler ou escrever no <em><a href=https://etcd.io/ >etcd</a></em> sem passar pelo <em><a href=https://kubernetes.io/docs/concepts/architecture/#kube-apiserver>kube-apiserver</a></em>. </p> <p>O <em><a href=https://etcd.io/ >etcd</a></em> não é um componente do projeto Kubernetes, mas é um projeto independente que também faz parte da <em><a href=../../capitulo-1/cloud-native/ >Cloud Native Computing Foundation (CNCF)</a></em>.</p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Existe um playground online acessível pelo link <em><a href=http://play.etcd.io/play>http://play.etcd.io/play</a></em>, que permite aprender e gerenciar clusters com o <em><a href=https://etcd.io/ >etcd</a></em>.</p> </div> <h4 id=kube-scheduler><strong><a href=https://kubernetes.io/docs/concepts/architecture/#kube-scheduler>kube-scheduler</a></strong></h4> <p>A principal função do <em><a href=https://kubernetes.io/docs/concepts/architecture/#kube-scheduler>kube-scheduler</a></em> é monitorar periodicamente o <em><a href=https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/ >kube-apiserver</a></em> em busca de novos <em>Pods</em> que precisam ser criados. Com base nas informações disponíveis, o <em><a href=https://kubernetes.io/docs/concepts/architecture/#kube-scheduler>kube-scheduler</a></em> seleciona um ou mais <em>Worker Nodes</em> adequados para a execução desses <em>Pods</em>, garantindo que os requisitos de recursos e restrições de afinidade sejam atendidos.</p> <p><img alt=alt_text src=../img/kube-scheduler-1.gif title=kube-scheduler></p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Uma explicação mais detalhada sobre objetos do Kubernetes será apresentada no capítulo <em><a href=../objetos-kubernetes/ >8.4 Objetos Kubernetes</a></em>. Por enquanto, é importante compreender que um <em>Pod</em> é um objeto do Kubernetes utilizado para definir uma unidade de execução que pode conter um ou mais <a href=../capitulo-7/containers.md>contêineres</a>.</p> </div> <p>Um <em>Pod</em> recém-criado não possui um <em>Worker Node</em> designado para sua execução. Chamamos de <em>"Unschedule Pod"</em> o <em>Pod</em> que não possui um <em>Worker Node</em> elegível para execução, e seu status fica como <em>"Pending"</em>. Já o termo <em>"Schedule"</em> refere-se ao processo de atribuição do <em>Pod</em> a um <em>Worker Node</em> capaz de realizar a sua execução. Em outras palavras, quando um <em>Pod</em> é <em>"scheduled"</em>, isso significa que ele foi atribuído a um <em>Worker Node</em> específico que é capaz de executá-lo.</p> <p>Além disso, o <em><a href=https://kubernetes.io/docs/concepts/architecture/#kube-scheduler>kube-scheduler</a></em> desempenha outras funções importantes, como a verificação de regras de afinidade e antiafinidade, a checagem da disponibilidade de portas de rede e a validação dos recursos de CPU e memória.</p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>O processo de <em>Scheduling</em> do Kubernetes é bem mais complexo do que foi descrito aqui. Para maiores detalhes, consulte o <em><a href=https://kubernetes.io/docs/concepts/scheduling-eviction/ >"Scheduling, Preemption and Eviction"</a></em>.</p> </div> <h4 id=kube-controller-manager><strong><a href=https://kubernetes.io/docs/concepts/architecture/#kube-controller-manager>kube-controller-manager</a></strong></h4> <p>O <em><a href=https://kubernetes.io/docs/concepts/architecture/#kube-controller-manager>kube-controller-manager</a></em>, também conhecido como <strong><em>controller</em></strong>, é responsável por executar o <strong><em>"loop de reconciliação" (reconciliation loop)</em></strong>, que tem como objetivo manter o <strong><em>"estado do cluster"</em></strong> em sincronia com as informações armazenadas no <em><a href=https://etcd.io/ >etcd</a></em>.</p> <p>Por exemplo, quando solicitado, o Kubernetes é capaz de manter um número específico de <em>Pods</em> distribuídos entre os diferentes <em>Worker Nodes</em>. Se, por qualquer motivo, o número total de <em>Pods</em> ativos divergir do número de <em>Pods</em> registrados no <em><a href=https://etcd.io/ >etcd</a></em>, o <strong><em>"loop de reconciliação"</em></strong> garantirá que os <em>Pods</em> ausentes sejam criados e iniciados. Vale ressaltar que essa verificação é um processo contínuo, o que justifica o uso da palavra <em>"loop"</em> para descrever sua funcionalidade.</p> <p><img alt=alt_text src=../img/kube-controller-manager-1.gif title=kube-controller-manager></p> <p>Há diferentes <strong><em>controller</em></strong> que fazem parte do <strong><em>"loop de reconciliação"</em></strong> e cada um deles é responsável por gerenciar e cuidar de um tipo específico de objeto Kubernetes. Alguns deles são:</p> <ul> <li>Replication Controller</li> <li>Deployment Controller</li> <li>Job Controller</li> <li>Namespace Controller</li> </ul> <h4 id=oci-cloud-controller-manager-ccm><strong><a href=https://github.com/oracle/oci-cloud-controller-manager>OCI Cloud Controller Manager (CCM)</a></strong></h4> <p>O <em><a href=https://github.com/oracle/oci-cloud-controller-manager>OCI Cloud Controller Manager</a></em> <em><a href=https://github.com/oracle/oci-cloud-controller-manager>(oci-cloud-controller-manager)</a></em>, é a implementação do <em><a href=https://kubernetes.io/docs/concepts/architecture/#cloud-controller-manager>cloud-controller-manager</a></em> responsável por conectar o Kubernetes às APIs do <a href=../capitulo-2/oci-foundation.md>OCI</a>.</p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>O <em><a href=https://github.com/oracle/oci-cloud-controller-manager>oci-cloud-controller-manager</a></em> é um projeto de código aberto mantido pela Oracle. O código-fonte da implementação pode ser acessado por meio do link <em><a href=https://github.com/oracle/oci-cloud-controller-manager>https://github.com/oracle/oci-cloud-controller-manager</a></em>.</p> </div> <p>Uma das funcionalidades do <em><a href=https://github.com/oracle/oci-cloud-controller-manager>oci-cloud-controller-manager</a></em> é a criação de <em><a href=../capitulo-4/load-balancer.md>Load Balance</a></em> no <a href=../capitulo-2/oci-foundation.md>OCI</a> por meio do do objeto <em>Service</em>.</p> <p><img alt=alt_text src=../img/oci-cloud-controller-manager-1.gif title=oci-cloud-controller-manager></p> <h3 id=compute-nodes-ou-worker-nodes><strong>Compute Nodes ou Worker Nodes</strong></h3> <p>Em resumo, os <em>Worker Nodes</em> têm a função de executar aplicações contêinerizadas, ou, mais precisamente, executar <em>Pods</em>.</p> <p>Existem, basicamente, três componentes do cluster Kubernetes que são executados nos <em>Worker Nodes</em> e são responsáveis pela execução dos Pods. São eles:</p> <h4 id=container-runtime><strong><a href=https://kubernetes.io/docs/setup/production-environment/container-runtimes/ >Container Runtime</a></strong></h4> <p>O <em><a href=https://kubernetes.io/docs/setup/production-environment/container-runtimes/ >Container Runtime</a></em> é o software responsável pela criação, execução e gerenciamento de contêineres nos <em>Worker Nodes</em>. É necessário instalar um <em><a href=https://kubernetes.io/docs/setup/production-environment/container-runtimes/ >Container Runtime</a></em> em cada <em>Worker Node</em> para que os <em>Pods</em> possam ser criados e executados.</p> <p>Existem diferentes <em><a href=https://kubernetes.io/docs/setup/production-environment/container-runtimes/ >Container Runtime</a></em> suportados e disponíveis para instalação, incluindo:</p> <ul> <li><a href=https://containerd.io/ >containerd</a></li> <li><a href=https://cri-o.io/ >CRI-O</a></li> <li><a href=https://www.docker.com/products/container-runtime/ >Docker Engine</a></li> <li><a href=https://www.mirantis.com/software/mirantis-container-runtime/ >Mirantis Container Runtime</a></li> </ul> <p><img alt=alt_text src=../img/kubernetes-container-runtime-1.png title="Container Runtime"></p> <p>O <em><a href=https://www.docker.com/products/container-runtime/ >Docker Engine</a></em> foi, por muito tempo, o <em><a href=https://kubernetes.io/docs/setup/production-environment/container-runtimes/ >Container Runtime</a></em> padrão para a execução de <a href=../capitulo-7/containers.md>contêineres</a> no Kubernetes. No entanto, em dezembro de 2020, com o lançamento da versão 1.20, o projeto Kubernetes anunciou a descontinuação do suporte ao <em><a href=https://www.docker.com/products/container-runtime/ >Docker Engine</a></em> como runtime de contêineres. Na versão 1.24, o suporte ao <em><a href=https://www.docker.com/products/container-runtime/ >Docker Engine</a></em> foi completamente removido.</p> <p>Essa decisão foi motivada para permitir a adoção de outros runtimes de contêiner, como <em><a href=https://containerd.io/ >containerd</a></em>, <em><a href=https://cri-o.io/ >CRI-O</a></em>, além de qualquer outro que siga as definições do <em><a href=https://kubernetes.io/blog/2016/12/container-runtime-interface-cri-in-kubernetes/ >Container Runtime Interface (CRI)</a></em>.</p> <p>Isso não significa que imagens de contêineres <em><a href=https://www.docker.com/ >Docker</a></em> não são compatíveis com o Kubernetes. Todas as imagens que seguem a especificação da <em><a href=https://opencontainers.org/ >Open Container Initiative</a></em>, são totalmente suportadas no Kubernetes, incluindo as imagens <em><a href=https://www.docker.com/ >Docker</a></em>.</p> <p>Atualmente, é comum ter instalações do <em><a href=https://containerd.io/ >containerd</a></em> ou <em><a href=https://cri-o.io/ >CRI-O</a></em> sendo utilizados como runtimes de contêiner. Por exemplo, o <em><a href=./funcionamento-provisionamento-oke.md>Oracle Kubernetes Engine (OKE)</a></em> utiliza o <em><a href=https://containerd.io/ >containerd</a></em> como seu runtime padrão.</p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Consulte o artigo <em><a href=https://kubernetes.io/blog/2020/12/02/dont-panic-kubernetes-and-docker/ >"Don't Panic: Kubernetes and Docker"</a></em> que aborda a remoção do <em><a href=https://www.docker.com/products/container-runtime/ >Docker Engine</a></em> como um runtime de contêiner suportado diretamente pelo Kubernetes.</p> </div> <h4 id=kubelet><strong><a href=https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/ >kubelet</a></strong></h4> <p>O <em><a href=https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/ >kubelet</a></em>, componente principal do <em>Worker Node</em>, é responsável por realizar consultas regulares ao <em><a href=https://kubernetes.io/docs/concepts/architecture/#kube-apiserver>kube-apiserver</a></em>, buscando informações sobre os <em>Pods</em> a serem criados ou removidos. Após obter essas informações, o <em><a href=https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/ >kubelet</a></em> interage diretamente com o <em><a href=https://kubernetes.io/docs/setup/production-environment/container-runtimes/ >Container Runtime</a></em> no <em>Worker Node</em> para a criação ou exclusão efetiva dos <em>Pods</em>.</p> <p><img alt=alt_text src=../img/kubernetes-kubelet-1.gif title=kubelet></p> <p>Mais especificamente, o <em><a href=https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/ >kubelet</a></em> obtém e processa o chamado <em><a href=https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#PodSpec>PodSpec</a></em>, que é um conjunto de informações que define as instruções de criação e o comportamento desejado do <em>Pod</em>. O <em><a href=https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#PodSpec>PodSpec</a></em> inclui detalhes como a imagem do contêiner a ser utilizada, as configurações de rede, as variáveis de ambiente, os recursos solicitados (como CPU e memória) e as políticas de <em>restart</em>. Com base nessas informações, o <em><a href=https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/ >kubelet</a></em> gerencia a execução do <em>Pod</em> no <em>Worker Node</em>, garantindo que ele atenda ao <em>"estado desejado"</em> especificado.</p> <h4 id=kube-proxy><strong><a href=https://kubernetes.io/docs/reference/command-line-tools-reference/kube-proxy/ >kube-proxy</a></strong></h4> <p>Em cada <em>Worker Node</em>, há uma instância em execução do <em><a href=https://kubernetes.io/docs/reference/command-line-tools-reference/kube-proxy/ >kube-proxy</a></em>, que funciona como um <em><a href=https://pt.wikipedia.org/wiki/Proxy>proxy de rede</a></em>, garantindo a conectividade interna e externa. É o <em><a href=https://kubernetes.io/docs/reference/command-line-tools-reference/kube-proxy/ >kube-proxy</a></em> que torna os <em>Pods</em> acessíveis na rede por meio do objeto <em>Service</em>.</p> <p><img alt=alt_text src=../img/kubernetes-kube-proxy-1.gif title=kube-proxy></p> <p>Assim como o <em><a href=https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/ >kubelet</a></em>, o <em><a href=https://kubernetes.io/docs/reference/command-line-tools-reference/kube-proxy/ >kube-proxy</a></em> também interage regularmente com o <em><a href=https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/ >kube-apiserver</a></em>.</p> <h2 id=932-addons>9.3.2 Addons</h2> <p><em><a href=https://kubernetes.io/docs/concepts/cluster-administration/addons/ >Addons</a></em> são ferramentas que estendem as funcionalidades do Kubernetes.</p> <p>Alguns <em><a href=https://kubernetes.io/docs/concepts/cluster-administration/addons/ >Addons</a></em> são essenciais para o funcionamento adequado do cluster, enquanto outros são opcionais.</p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Para uma lista mais completa sobre os <em><a href=https://kubernetes.io/docs/concepts/cluster-administration/addons/ >Addons</a></em> disponíveis, consulte o link <em><a href=https://kubernetes.io/docs/concepts/cluster-administration/addons/ >"Installing Addons"</a></em>.</p> </div> <p>Alguns exemplos de <em><a href=https://kubernetes.io/docs/concepts/cluster-administration/addons/ >Addons</a></em> essenciais incluem:</p> <ul> <li><strong><a href=https://coredns.io/manual/toc/#what-is-coredns>CoreDNS</a></strong><ul> <li>O <em><a href=https://coredns.io/manual/toc/#what-is-coredns>CoreDNS</a></em> é um servidor DNS mais simples em comparação com servidores mais completos, como o <em><a href=https://www.isc.org/bind/ >BIND</a></em>. Ele foi projetado para ser utilizado como o servidor DNS padrão no Kubernetes, desempenhando a função de resolver nomes de <em>Services</em> e <em>Pods</em> dentro do cluster. No entanto, ele também pode ser configurado para atuar como um servidor <em><a href=https://pt.wikipedia.org/wiki/Sistema_de_Nomes_de_Dom%C3%ADnio#M%C3%A9todos_de_resolu%C3%A7%C3%A3o:_iterativo_e_recursivo>DNS recursivo</a></em>, permitindo a resolução de nomes externos.</li> </ul> </li> </ul> <p><img alt=alt_text src=../img/core-dns-logo-1.png title=CoreDNS></p> <ul> <li> <p><strong>CNI plugin for pod networking</strong></p> <ul> <li> <p><em><a href=https://www.cni.dev/ >CNI (Container Network Interface)</a></em> é uma especificação e um conjunto de padrões que define uma interface para a configuração de redes em ambientes de contêineres. As implementações <em><a href=https://www.cni.dev/ >CNI</a></em> mais utilizados no <em><a href=./funcionamento-provisionamento-oke.md>OKE</a></em> são:</p> </li> <li> <p><a href=https://github.com/flannel-io/flannel>Flannel</a></p> <ul> <li>O plug-in CNI <em><a href=https://github.com/flannel-io/flannel>Flannel</a></em> fornece uma rede para os <em>Pods</em> sem utilizar os endereços IP disponíveis de uma sub-rede do <a href=../capitulo-2/oci-foundation.md>OCI</a>. A rede disponibilizada pelo CNI <em><a href=https://github.com/flannel-io/flannel>Flannel</a></em> é frequentemente chamada de <em>"rede de sobreposição"</em>, pois consiste em uma rede IP que existe somente dentro do cluster, mais especificamente, nos <em>Worker Nodes</em>.</li> </ul> </li> <li> <p><a href=https://docs.oracle.com/pt-br/iaas/Content/ContEng/Concepts/contengpodnetworking_topic-OCI_CNI_plugin.htm>OCI VCN-Native</a></p> <ul> <li>O plugin <em><a href=https://docs.oracle.com/pt-br/iaas/Content/ContEng/Concepts/contengpodnetworking_topic-OCI_CNI_plugin.htm>OCI VCN-Native</a></em> Pod Networking CNI, aloca endereços IP de uma sub-rede do <a href=../capitulo-2/oci-foundation.md>OCI</a> diretamente para os <em>Pods</em>. Isso permite que os <em>Pods</em> se comuniquem entre si de forma direta, sem a necessidade de utilizar um <em>Service</em>. Com essa abordagem, os <em>Pods</em> se tornam <em>roteáveis</em>, assim como qualquer outro recurso que utilize um endereço IP, facilitando a comunicação e a integração dentro do ambiente de rede.</li> </ul> </li> </ul> </li> </ul> <p><img alt=alt_text src=../img/flannel-cni-logo-1.png title=Flannel></p> <p>Alguns exemplos de <em><a href=https://kubernetes.io/docs/concepts/cluster-administration/addons/ >Addons</a></em> opcionais incluem:</p> <ul> <li> <p><a href=https://github.com/kubernetes/dashboard>Kubernetes Dashboard</a></p> <ul> <li>O <em><a href=https://github.com/kubernetes/dashboard>Kubernetes Dashboard</a></em> é uma aplicação Web projetada para administrar, monitorar e gerenciar <em>Pods, Services, Deployments</em> e outros componentes, além de fornecer uma visão geral do próprio cluster Kubernetes.</li> </ul> </li> <li> <p><a href=https://github.com/kubernetes/autoscaler>Kubernetes Autoscaler</a></p> <ul> <li>O <em><a href=https://github.com/kubernetes/autoscaler>Kubernetes Autoscaler</a></em> é um <em><a href=https://kubernetes.io/docs/concepts/cluster-administration/addons/ >addon</a></em> que ajusta automaticamente a capacidade de um cluster Kubernetes com base na demanda de recursos. Ele opera em duas frentes principais: o <em>HPA (Horizontal Pod Autoscaler)</em>, que tem como objetivo escalar horizontalmente, ou seja, aumentar ou diminuir o número de réplicas de um <em>Pod</em>, e o <em>VPA (Vertical Pod Autoscaler)</em>, que modifica a quantidade de recursos, como CPU e memória, alocados para um <em>Pod</em>.</li> </ul> </li> <li> <p><a href=https://docs.oracle.com/pt-br/iaas/Content/ContEng/Tasks/contengsettingupnativeingresscontroller-cluster-addon-top-level.htm#contengsettingupnativeingresscontroller-cluster-addon-top-level>OCI Native Ingress Controller</a></p> <ul> <li>É um componente desenvolvido pela Oracle que permite gerenciar o <em>tráfego de entrada (ingress)</em> para aplicações em execução em um cluster Kubernetes que está hospedado no <a href=../capitulo-2/oci-foundation.md>OCI</a>. Ele fornece uma maneira de expor serviços de aplicações para o mundo externo, permitindo que os usuários acessem essas aplicações através de URLs e domínios.</li> </ul> </li> <li> <p><a href=https://github.com/NVIDIA/k8s-device-plugin>NVIDIA GPU Plugin</a></p> <ul> <li>É um <em><a href=https://kubernetes.io/docs/concepts/cluster-administration/addons/ >addon</a></em> que permite expor um número de <em>GPUs NVIDIA</em> para utilização em cada <em>Worker Node</em>.</li> </ul> </li> </ul> <h2 id=933-como-o-kubernetes-funciona-do-inicio-ao-fim-resumo>9.3.3 Como o Kubernetes Funciona do Início ao Fim (resumo)</h2> <ol> <li> <p>Você configura um cluster Kubernetes – ele é composto de Master Nodes e Worker Nodes.</p> </li> <li> <p>Você define sua aplicação usando arquivos YAML – normalmente com Deployment, Service, ConfigMap, etc.</p> </li> <li> <p>Você aplica o YAML usando o comando <code>kubectl apply -f</code>. A solicitação vai para o API Server nos Master Nodes.</p> </li> <li> <p>O Kubernetes verifica a solicitação para decidir o que fazer: <br> a. Criar um novo objeto como um Pod ou Deployment? <br> b. Atualizar ou excluir um objeto existente? <br> c. Acionar um controlador para executar alguma ação? etc.</p> </li> <li> <p>O API Server armazena a especificação do objeto no etcd, o banco de dados do cluster.</p> </li> <li> <p>O controlador apropriado vê a nova especificação – como um controlador ReplicaSet monitorando novos Deployments.</p> </li> <li> <p>O controlador cria os recursos necessários – por exemplo, dizendo ao scheduler para posicionar novos Pods.</p> </li> <li> <p>O scheduler escolhe um nó adequado para cada Pod – com base na disponibilidade de recursos e regras de agendamento.</p> </li> <li> <p>A especificação do Pod é enviada para o Kubelet do nó – ele solicita ao runtime do contêiner que inicie o contêiner.</p> </li> <li> <p>O runtime do contêiner faz o pull da imagem, cria o contêiner e o executa dentro do Pod.</p> </li> <li> <p>O plugin CNI atribui uma identidade de rede – o Pod recebe um endereço IP e se junta à rede do cluster.</p> </li> <li> <p>O kube-proxy configura regras de roteamento – permitindo que os Services encaminhem tráfego para Pods saudáveis.</p> </li> <li> <p>O Kubelet relata o status dos Pods de volta ao API Server – usado para rastrear prontidão e saúde.</p> </li> <li> <p>Se um Pod falhar ou for excluído, o controlador percebe e o recria – mantendo o sistema sincronizado.</p> </li> <li> <p>Esse loop inteiro continua funcionando – o Kubernetes observa constantemente e reconcilia para corresponder ao estado desejado.</p> </li> </ol> <h2 id=934-conclusao>9.3.4 Conclusão</h2> <p>Neste capítulo, foi apresentada uma visão geral do funcionamento e da arquitetura de um cluster Kubernetes. Foram explorados os diversos componentes de software que o compõem, destacando suas funções e a maneira como interagem entre si para formar o ecossistema do Kubernetes. Compreender a totalidade do sistema é fundamental não apenas para entender como o Kubernetes opera, mas também para auxiliar na identificação e resolução de problemas que possam surgir.</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 Daniel Armbrust. Todos os direitos reservados. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://www.linkedin.com/in/daniel-armbrust/ target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.path", "navigation.indexes", "navigation.top"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.f55a23d4.min.js></script> </body> </html>