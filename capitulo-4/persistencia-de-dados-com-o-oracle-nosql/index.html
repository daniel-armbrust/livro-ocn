<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Guia Prático para Implantação de Aplicações Cloud Native na Oracle Cloud Infrastructure (OCI)."><meta name=author content="Daniel Armbrust (darmbrust@gmail.com)"><link href=https://ocn.dev.br/capitulo-4/persistencia-de-dados-com-o-oracle-nosql/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.0"><title>Capítulo 4: Serviços Auxiliares e Persistência de Dados - OCN - Oracle Cloud Native</title><link rel=stylesheet href=../../assets/stylesheets/main.618322db.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i%7CRed+Hat+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Open Sans";--md-code-font:"Red Hat Mono"}</style><link rel=stylesheet href=../../css/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=deep-orange> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#capitulo-4-servicos-auxiliares-e-persistencia-de-dados class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="OCN - Oracle Cloud Native" class="md-header__button md-logo" aria-label="OCN - Oracle Cloud Native" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> OCN - Oracle Cloud Native </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Capítulo 4: Serviços Auxiliares e Persistência de Dados </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=deep-orange aria-label="Light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=deep-purple aria-label="Dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <div class=md-header__source> <a href=https://github.com/daniel-armbrust/livro-ocn title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="OCN - Oracle Cloud Native" class="md-nav__button md-logo" aria-label="OCN - Oracle Cloud Native" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> OCN - Oracle Cloud Native </label> <div class=md-nav__source> <a href=https://github.com/daniel-armbrust/livro-ocn title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../prefacio/ class=md-nav__link> <span class=md-ellipsis> Prefácio </span> </a> </li> <li class=md-nav__item> <a href=../../sobre-o-autor/ class=md-nav__link> <span class=md-ellipsis> Sobre o Autor </span> </a> </li> <li class=md-nav__item> <a href=../../como-usar-este-livro/ class=md-nav__link> <span class=md-ellipsis> Como usar este Livro </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-1/ class=md-nav__link> <span class=md-ellipsis> Capítulo 1 - Introdução à Computação em Nuvem </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-2/ class=md-nav__link> <span class=md-ellipsis> Capítulo 2 - Aplicação OCI PIZZA </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-3/ class=md-nav__link> <span class=md-ellipsis> Capítulo 3 - OCI Foundations </span> </a> </li> <li class=md-nav__item> <a href=../ class=md-nav__link> <span class=md-ellipsis> Capítulo 4 - Serviços Auxiliares e Persistência de Dados </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-5/ class=md-nav__link> <span class=md-ellipsis> Capítulo 5 - Conectividade e Redes </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-6/ class=md-nav__link> <span class=md-ellipsis> Capítulo 6 - Contêineres, Docker e Funções </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-7/ class=md-nav__link> <span class=md-ellipsis> Capítulo 7 - Publicando a Aplicação na Web </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-8/ class=md-nav__link> <span class=md-ellipsis> Capítulo 8 - Oracle Kubernetes Engine (OKE) </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-9/ class=md-nav__link> <span class=md-ellipsis> Capítulo 9 - Serviço DevOps </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-10/ class=md-nav__link> <span class=md-ellipsis> Capítulo 10 - Monitoração e Observabilidade </span> </a> </li> <li class=md-nav__item> <a href=../../capitulo-11/ class=md-nav__link> <span class=md-ellipsis> Capítulo 11 - Infraestrutura como Código (IaC) </span> </a> </li> <li class=md-nav__item> <a href=../../apendice-a/ class=md-nav__link> <span class=md-ellipsis> Apêndice A - OCI HOWTOs </span> </a> </li> <li class=md-nav__item> <a href=../../bibliografia/ class=md-nav__link> <span class=md-ellipsis> Bibliografia </span> </a> </li> <li class=md-nav__item> <a href=../../changelog/ class=md-nav__link> <span class=md-ellipsis> ChangeLog </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc hidden> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=capitulo-4-servicos-auxiliares-e-persistencia-de-dados>Capítulo 4: Serviços Auxiliares e Persistência de Dados</h1> <h1 id=42-persistencia-de-dados-com-o-oracle-nosql>4.2 Persistência de dados com o Oracle NoSQL</h1> <h2 id=421-sql-vs-nosql>4.2.1 SQL vs. NoSQL</h2> <p>O principal propósito de um banco de dados é armazenar, gerenciar e recuperar grandes volumes de dados de forma eficiente e segura.</p> <p>No <a href=https://pt.wikipedia.org/wiki/Modelo_relacional target=_blank>modelo relacional</a>, os dados são organizados em tabelas, onde cada tabela é composta por linhas e colunas. Essas tabelas podem se relacionar umas com as outras, <strong>formando relações</strong> que constituem a base do <a href=https://pt.wikipedia.org/wiki/Modelo_relacional target=_blank>modelo relacional</a>. É por essa razão que os bancos de dados que implementam esse modelo são conhecidos como <strong>Sistemas de Gerenciamento de Banco de Dados Relacional (SGBD)</strong> ou, em inglês, <strong>Relational Database Management System (RDBMS)</strong>.</p> <p><img alt=alt_text src=../img/sql-table-relationship-1.png title="Modelo Relacional #1"></p> <p>Bancos de dados relacionais, como <a href=https://docs.oracle.com/en/database/oracle/oracle-database/23/index.html target=_blank>Oracle Database</a>, <a href=https://docs.oracle.com/pt-br/iaas/mysql-database/home.htm target=_blank>MySQL</a> e <a href=https://docs.oracle.com/pt-br/iaas/Content/postgresql/home.htm target=_blank>PostgreSQL</a>, desempenham um papel vital na persistência segura das informações, além de gerenciar múltiplos acessos de escrita concorrente por meio de <a href=https://pt.wikipedia.org/wiki/Transa%C3%A7%C3%A3o_(banco_de_dados) target=_blank><i><b>transações</b></i></a>.</p> <p>O termo <a href=https://pt.wikipedia.org/wiki/Transa%C3%A7%C3%A3o_(banco_de_dados) target=_blank><i>"transação"</i></a> refere-se a <a href=https://pt.wikipedia.org/wiki/Transa%C3%A7%C3%A3o_(banco_de_dados) target=_blank>transações</a> <a href=https://pt.wikipedia.org/wiki/ACID target=_blank>ACID (Atômicas, Consistentes, Isoladas e Duráveis)</a>, que asseguram a consistência dos dados, permitindo a adição, exclusão ou modificação de múltiplos registros em diferentes tabelas por meio de uma única operação. As <a href=https://pt.wikipedia.org/wiki/Transa%C3%A7%C3%A3o_(banco_de_dados) target=_blank>transações</a> incorporam o conceito de unidade de trabalho, garantindo sucesso total ou falha total (tudo ou nada), sem espaço para um meio termo. Além disso, as <a href=https://pt.wikipedia.org/wiki/Transa%C3%A7%C3%A3o_(banco_de_dados) target=_blank>transações</a> permitem decidir se as alterações devem ser <em>persistidas (commit)</em> ou <em>descartadas (rollback)</em>. </p> <p>Já os bancos de dados do tipo <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>NoSQL</a>, representam uma nova abordagem para o armazenamento e gerenciamento de dados, diferente do <a href=https://pt.wikipedia.org/wiki/Modelo_relacional target=_blank>modelo relacional</a>. Eles foram desenvolvidos para operar em grandes <a href=https://pt.wikipedia.org/wiki/Cluster target=_blank>clusters de computadores</a>, que favorecem a <a href=../../capitulo-1/terminologias-da-computacao-em-nuvem/#escalabilidade-scalability>escalabilidade horizontal</a>, e para atender à necessidade de aplicações que exigem um modelo de dados mais flexível ou <strong>schemaless</strong>.</p> <p><strong>NoSQL ("Not SQL" ou "Not Only SQL")</strong> não possui uma definição precisa. Ele é utilizado para descrever vários bancos de dados <strong>não relacionais</strong>, como <a href=https://redis.io/ target=_blank>Redis</a>, <a href=https://www.mongodb.com/ target=_blank>MongoDB</a>, <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>Oracle NoSQL Database</a>, <a href=https://neo4j.com/ target=_blank>Neo4J</a>, entre outros.</p> <p>Diferente dos bancos de dados do tipo <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>NoSQL</a>, bancos de dados relacionais não conseguem <a href=../../capitulo-1/terminologias-da-computacao-em-nuvem/#escalabilidade-scalability>escalar horizontalmente</a> devido ao funcionamento das <a href=https://pt.wikipedia.org/wiki/ACID target=_blank>transações ACID</a>, que são incompatíveis com a execução em <a href=https://pt.wikipedia.org/wiki/Cluster target=_blank>clusters de computadores</a>. Isso ocorre porque não é possível garantir a consistência dos dados nem realizar um <a href=https://pt.wikipedia.org/wiki/Join_(SQL) target=_blank>JOIN</a> sobre dados distribuídos entre várias máquinas do cluster.</p> <p>Para exemplificar, imagine uma instrução SQL que realiza um <a href=https://pt.wikipedia.org/wiki/Join_(SQL) target=_blank>JOIN</a> entre diferentes tabelas armazenadas em várias máquinas conectadas à rede (<a href=https://pt.wikipedia.org/wiki/Cluster target=_blank>clusters de computadores</a>). Esse <a href=https://pt.wikipedia.org/wiki/Join_(SQL) target=_blank>JOIN</a>, que precisa recuperar dados de diferentes tabelas pela rede, pode enfrentar problemas como alta latência ou até mesmo erros de conexão, resultando na impossibilidade de retornar os dados solicitados.</p> <p><img alt=alt_text src=../img/sql-cluster-join-1.png title="SQL Cluster JOIN #1"></p> <p>Por outro lado, os bancos de dados relacionais foram projetados para operar em uma única máquina. Isso permite que as <a href=https://pt.wikipedia.org/wiki/ACID target=_blank>transações ACID</a> sejam viáveis, uma vez que as tabelas estão contidas em uma única camada de storage, que pode ser dividida entre múltiplos discos conectados por barramentos de alta velocidade.</p> <p><img alt=alt_text src=../img/sql-join-storage-1.png title="SQL JOIN #1"></p> <p>É importante mencionar que os bancos de dados <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>NoSQL</a> não substituem os bancos de dados relacionais, e vice-versa. Os bancos de dados <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>NoSQL</a>, que lidam com dados não estruturados, complementam os bancos de dados SQL em soluções empresariais. Na prática, é fundamental entender as necessidades do negócio e identificar onde cada tecnologia se <em>"encaixa melhor"</em>.</p> <h3 id=resumo-das-principais-diferencas><strong>Resumo das principais diferenças</strong></h3> <p><img alt=alt_text src=../img/sql-vs-nosql-1.png title="SQL vs. NoSQL #1"></p> <h2 id=422-tipos-de-banco-de-dados-nosql>4.2.2 Tipos de Banco de Dados NoSQL</h2> <p>A maioria dos bancos de dados <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>NoSQL</a> é baseada em alguma forma de estrutura chave/valor, sendo as quatro principais categorias as seguintes:</p> <p><img alt=alt_text src=../img/nosql-tipos-1.png title="Tipos de NoSQL #1"></p> <ul> <li> <p><strong>Chave/Valor</strong></p> <ul> <li>Os dados são armazenados por meio de chaves únicas.</li> <li>Aqui, o banco de dados não conhece nem se preocupa com o valor ao qual a chave se refere. Assim, a recuperação de dados só é possível por meio de consultas que envolvam as chaves.</li> </ul> </li> <li> <p><strong>Documentos</strong></p> <ul> <li>É bastante similar à implementação chave/valor e neste caso, o banco de dados conhece o valor (documento) ao qual a chave se refere.</li> </ul> </li> <li> <p><strong>Grafos</strong></p> <ul> <li>Semelhante ao modelo relacional.</li> <li>É especialmente útil para dados altamente interconectados, uma vez que a estrutura de um grafo revela de forma natural os relacionamentos entre os objetos.</li> </ul> </li> <li> <p><strong>Colunar</strong></p> <ul> <li>O armazenamento colunar é semelhante a uma tabela.</li> </ul> </li> </ul> <h2 id=423-introducao-ao-oracle-nosql-database-cloud-service>4.2.3 Introdução ao Oracle NoSQL Database Cloud Service</h2> <p>O <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>Oracle NoSQL Database Cloud Service</a> é um serviço de banco de dados <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>NoSQL</a> totalmente gerenciado no <a href=../../capitulo-3/introducao-ao-oci/ >OCI</a>, que permite aos desenvolvedores concentrar-se no desenvolvimento de aplicações, em vez de se preocupar com a configuração de servidores.</p> <p>O serviço oferece suporte ao armazenamento de documentos <a href=https://pt.wikipedia.org/wiki/JSON target=_blank>JSON</a>, dados do tipo chave/valor e dados em colunas. Ele já inclui, por padrão, monitoramento, alta disponibilidade com dados distribuídos automaticamente entre <a href=../../capitulo-3/introducao-ao-oci/#313-fault-domains-fd>Fault Domains</a> e <a href=../../capitulo-3/introducao-ao-oci/#312-availability-domains-ad>Availability Domains</a>, além de fácil escalabilidade com baixo tempo de resposta. Além disso, fornece uma variedade de recursos adicionais, incluindo:</p> <ul> <li>Suporte a transações ACID.</li> <li>Atualizações parciais em documentos JSON.</li> <li>Criação de índices adicionais.</li> <li>Manipulação e acesso aos dados via linguagem SQL padrão.</li> <li>TTL (Tempo de Vida) permite definir um tempo de expiração para as linhas da tabela, de modo que, ao ultrapassar esse limite, a linha será automaticamente excluída.</li> <li>Replicação de dados entre diferentes regiões por meio da funcionalidade <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/gasnd/index.html target=_blank>Global Active Tables</a>.</li> </ul> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Para mais informações sobre o serviço, consulte o link <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank><i>"Oracle NoSQL Database Cloud Service"</i></a>.</p> </div> <h3 id=tabelas><strong><a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>Tabelas</a></strong></h3> <p>No <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>Oracle NoSQL</a>, os dados são armazenados e organizados em <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>Tabelas</a>, sendo possível criar tanto tabelas <strong>sem um esquema fixo</strong> quanto tabelas com <strong>esquema fixo</strong>.</p> <p>Uma <strong>tabela sem esquema</strong>, ou <strong>schemaless</strong>, é basicamente uma <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabela</a> que armazena documentos <a href=https://pt.wikipedia.org/wiki/JSON target=_blank>JSON</a>, onde cada documento inserido pode ter uma estrutura única e independente. Nesse caso, o banco de dados não valida a estrutura interna do <a href=https://pt.wikipedia.org/wiki/JSON target=_blank>JSON</a> antes de persistir os dados, ele apenas verifica se o dado possui um documento <a href=https://pt.wikipedia.org/wiki/JSON target=_blank>JSON</a> válido.</p> <div class="language-sql highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1>1</a></span>
<span class=normal><a href=#__codelineno-0-2>2</a></span>
<span class=normal><a href=#__codelineno-0-3>3</a></span>
<span class=normal><a href=#__codelineno-0-4>4</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>produtos</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2></a><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>GENERATED</span><span class=w> </span><span class=n>ALWAYS</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>IDENTITY</span><span class=w> </span><span class=p>(</span><span class=k>START</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>INCREMENT</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=mi>1</span><span class=p>),</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3></a><span class=w>    </span><span class=n>propriedades</span><span class=w> </span><span class=n>JSON</span><span class=p>,</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4></a><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=n>id</span><span class=p>))</span>
</span></code></pre></div></td></tr></table></div> <p>Uma <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabela</a> com um <strong>esquema fixo</strong> possui colunas que têm tipos de dados específicos. Isso significa que, antes de persistir os dados, o banco de dados valida os dados em relação ao tipo definido para cada coluna. Por exemplo, uma coluna definida para armazenar valores inteiros aceitará apenas números inteiros, enquanto uma coluna de texto permitirá apenas strings. </p> <div class="language-sql highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-1-1>1</a></span>
<span class=normal><a href=#__codelineno-1-2>2</a></span>
<span class=normal><a href=#__codelineno-1-3>3</a></span>
<span class=normal><a href=#__codelineno-1-4>4</a></span>
<span class=normal><a href=#__codelineno-1-5>5</a></span>
<span class=normal><a href=#__codelineno-1-6>6</a></span>
<span class=normal><a href=#__codelineno-1-7>7</a></span>
<span class=normal><a href=#__codelineno-1-8>8</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>produtos</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2></a><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>GENERATED</span><span class=w> </span><span class=n>ALWAYS</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>IDENTITY</span><span class=w> </span><span class=p>(</span><span class=k>START</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>INCREMENT</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=mi>1</span><span class=p>),</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3></a><span class=w>    </span><span class=n>nome</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4></a><span class=w>    </span><span class=n>descricao</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5></a><span class=w>    </span><span class=n>valor</span><span class=w> </span><span class=nb>NUMBER</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6></a><span class=w>    </span><span class=n>frete_gratis</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>TRUE</span><span class=p>,</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7></a><span class=w>    </span><span class=n>imagens</span><span class=w> </span><span class=nb>ARRAY</span><span class=p>(</span><span class=n>STRING</span><span class=p>),</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8></a><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=n>id</span><span class=p>))</span>
</span></code></pre></div></td></tr></table></div> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Consulte o link <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/rnpxl/index.html target=_blank><i>"Supported Data Types"</i></a> para acessar a lista dos tipos de dados suportados pelo <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>Oracle NoSQL</a>.</p> </div> <p>O <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>Oracle NoSQL</a> também suporta <strong>tabelas híbridas (Hybrid Tables)</strong>, que permitem a combinação de colunas do tipo <a href=https://pt.wikipedia.org/wiki/JSON target=_blank>JSON</a> para armazenar documentos sem estrutura fixa e colunas com tipos de dados específicos.</p> <div class="language-sql highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-2-1>1</a></span>
<span class=normal><a href=#__codelineno-2-2>2</a></span>
<span class=normal><a href=#__codelineno-2-3>3</a></span>
<span class=normal><a href=#__codelineno-2-4>4</a></span>
<span class=normal><a href=#__codelineno-2-5>5</a></span>
<span class=normal><a href=#__codelineno-2-6>6</a></span>
<span class=normal><a href=#__codelineno-2-7>7</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>produtos</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2></a><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>GENERATED</span><span class=w> </span><span class=n>ALWAYS</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>IDENTITY</span><span class=w> </span><span class=p>(</span><span class=k>START</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>INCREMENT</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=mi>1</span><span class=p>),</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3></a><span class=w>    </span><span class=n>propriedades</span><span class=w> </span><span class=n>JSON</span><span class=p>,</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4></a><span class=w>    </span><span class=n>valor</span><span class=w> </span><span class=nb>NUMBER</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5></a><span class=w>    </span><span class=n>frete_gratis</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>TRUE</span><span class=p>,</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6></a><span class=w>    </span><span class=n>imagens</span><span class=w> </span><span class=nb>ARRAY</span><span class=p>(</span><span class=n>STRING</span><span class=p>),</span><span class=w>   </span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7></a><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=n>id</span><span class=p>))</span>
</span></code></pre></div></td></tr></table></div> <p><img alt=alt_text src=../img/nosql-tipos-2.png title="Tipos de NoSQL #2"></p> <p>Independentemente de a <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabela</a> ter um esquema fixo ou não, é obrigatório criar pelo menos uma coluna destinada a ser a chave primária da <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabela</a> por meio da instrução <code>PRIMARY KEY</code>. As colunas designadas como chave primária devem ser dos tipos <code>INTEGER</code>, <code>LONG</code>, <code>FLOAT</code>, <code>DOUBLE</code>, <code>NUMBER</code>, <code>STRING</code>, <code>ENUM</code>, <code>BOOLEAN</code> ou <code>TIMESTAMP</code>.</p> <p>A coluna <code>id</code> nas instruções SQL acima, além de ser a chave primária, é designada como <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/identity-column.html target=_blank>coluna de identidade (IDENTITY Column)</a>. Essa coluna especial é projetada para gerar automaticamente valores únicos e sequenciais para cada novo registro inserido, eliminando a necessidade de gerenciar os valores da chave primária manualmente pela aplicação.</p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Consulte o link <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/create-table.html target=_blank><i>"CREATE TABLE Statement"</i></a> para obter mais informações sobre a sintaxe do comando <code>CREATE TABLE</code>, e <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/identity-column.html target=_blank><i>"Using the IDENTITY Column"</i></a> para saber mais sobre <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/identity-column.html target=_blank>coluna de identidade</a> no <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>Oracle NoSQL</a>.</p> </div> <h3 id=armazenamento-unidades-de-escrita-e-leitura><strong>Armazenamento, Unidades de Escrita e Leitura</strong></h3> <p>Ao criar uma <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabela</a>, é necessário especificar a <strong>quantidade total de armazenamento em Gigabytes</strong> (<code>maxStorageInGBs</code>), além de duas propriedades que determinam as <strong>capacidades de leitura</strong> (<code>maxReadUnits</code>) e <strong>escrita</strong> (<code>maxWriteUnits</code>) da <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabela</a>, as quais são:</p> <ul> <li> <p><strong>Unidades de Escrita ou Gravação</strong> (<code>maxWriteUnits</code>)</p> <ul> <li>Uma unidade de escrita corresponde a um throughput de até 1 kilobyte (KB) de dados por segundo para operações como inserção, atualização ou exclusão de um registro. Atualizações de índices também consomem unidades de escrita.</li> <li>Por exemplo: um registro com menos de 1 KB requer 1 unidade de escrita. Para operações em registros de 1,5 KB, são necessárias 2 unidades de escrita.</li> </ul> </li> <li> <p><strong>Unidades de Leitura</strong> (<code>maxReadUnits</code>)</p> <ul> <li>Uma unidade de leitura corresponde a um throughput de até 1 kilobyte (KB) de dados por segundo em operações de leitura eventualmente consistentes.</li> <li>Por exemplo, um registro com menos de 1 KB de dados exige apenas 1 unidade de leitura eventualmente consistente. Para um registro que contém 1,5 KB de dados, serão necessárias 2 unidades de leitura eventualmente consistentes.</li> </ul> </li> <li> <p><strong>Capacidade de Armazenamento em Gigabytes</strong> (<code>maxStorageInGBs</code>)</p> <ul> <li>A capacidade de armazenamento refere-se ao total disponível em gigabytes (GB) para a tabela de dados NoSQL, representando a quantidade máxima de informações que podem ser armazenadas.</li> </ul> </li> </ul> <p>Durante a criação da <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabela</a>, tanto a <strong>capacidade de armazenamento</strong> quanto as <strong>unidades de leitura e escrita</strong> são controladas pelo parâmetro <code>capacityMode</code>, que pode ser definido manualmente (<code>PROVISIONED</code>) ou, deixar o <a href=../../capitulo-3/introducao-ao-oci/ >OCI</a> ajustar automaticamente os valores conforme a demanda por algum deles aumentar mais do que o especificado (<code>ON_DEMAND</code>). </p> <p>Utilizar <code>PROVISIONED</code> é financeiramente mais barato, porém exige que o administrador ou alguma funcionalidade da aplicação, ajuste os valores para cima quando a demanda aumenta. </p> <p>Por exemplo, no modo <code>PROVISIONED</code>, se a quantidade de leituras realizadas exceder o limite definido por <code>maxReadUnits</code>, uma exceção será retornada com a seguinte mensagem: <code>Operation failed with limit exception: Read throughput rate exceeded for table user. Limit: 1 Units/Sec</code></p> <p>Em contrapartida, <code>ON_DEMAND</code> é mais custoso, pois o <a href=../../capitulo-3/introducao-ao-oci/ >OCI</a> ajustará esses valores automaticamente, sem necessidade de intervenção.</p> <p>Abaixo está um exemplo da criação de uma <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabela</a> em que seus limites de utilização são especificados pelo parâmetro <code>--table-limits</code>: </p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-3-1> 1</a></span>
<span class=normal><a href=#__codelineno-3-2> 2</a></span>
<span class=normal><a href=#__codelineno-3-3> 3</a></span>
<span class=normal><a href=#__codelineno-3-4> 4</a></span>
<span class=normal><a href=#__codelineno-3-5> 5</a></span>
<span class=normal><a href=#__codelineno-3-6> 6</a></span>
<span class=normal><a href=#__codelineno-3-7> 7</a></span>
<span class=normal><a href=#__codelineno-3-8> 8</a></span>
<span class=normal><a href=#__codelineno-3-9> 9</a></span>
<span class=normal><a href=#__codelineno-3-10>10</a></span>
<span class=normal><a href=#__codelineno-3-11>11</a></span>
<span class=normal><a href=#__codelineno-3-12>12</a></span>
<span class=normal><a href=#__codelineno-3-13>13</a></span>
<span class=normal><a href=#__codelineno-3-14>14</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1></a>$<span class=w> </span>oci<span class=w> </span>nosql<span class=w> </span>table<span class=w> </span>create<span class=w> </span><span class=se>\</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2></a>&gt;<span class=w> </span>--region<span class=w> </span><span class=s2>&quot;sa-saopaulo-1&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3></a>&gt;<span class=w> </span>--compartment-id<span class=w> </span><span class=s2>&quot;ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4></a>&gt;<span class=w> </span>--name<span class=w> </span><span class=s2>&quot;pizza&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5></a>&gt;<span class=w> </span>--table-limits<span class=w> </span><span class=s2>&quot;{\&quot;capacityMode\&quot;: \&quot;PROVISIONED\&quot;, \&quot;maxReadUnits\&quot;: 5, \&quot;maxWriteUnits\&quot;: 5, \&quot;maxStorageInGBs\&quot;: 2}&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6></a>&gt;<span class=w> </span>--wait-for-state<span class=w> </span><span class=s2>&quot;SUCCEEDED&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7></a>&gt;<span class=w> </span>--ddl-statement<span class=w> </span><span class=s2>&quot;</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8></a><span class=s2>     CREATE TABLE IF NOT EXISTS pizza (</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9></a><span class=s2>        id INTEGER,</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10></a><span class=s2>        name STRING,</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11></a><span class=s2>        description STRING,</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12></a><span class=s2>        image STRING,</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13></a><span class=s2>        price NUMBER</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14></a><span class=s2>     PRIMARY KEY(id))&quot;</span>
</span></code></pre></div></td></tr></table></div> <p>Para atualizar manualmente as capacidades da <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabela</a>, seja aumentando ou diminuindo, utilize o seguinte comando:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-4-1>1</a></span>
<span class=normal><a href=#__codelineno-4-2>2</a></span>
<span class=normal><a href=#__codelineno-4-3>3</a></span>
<span class=normal><a href=#__codelineno-4-4>4</a></span>
<span class=normal><a href=#__codelineno-4-5>5</a></span>
<span class=normal><a href=#__codelineno-4-6>6</a></span>
<span class=normal><a href=#__codelineno-4-7>7</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1></a>$<span class=w> </span>oci<span class=w> </span>nosql<span class=w> </span>table<span class=w> </span>update<span class=w> </span><span class=se>\</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2></a>&gt;<span class=w> </span>--region<span class=w> </span><span class=s2>&quot;sa-saopaulo-1&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3></a>&gt;<span class=w> </span>--compartment-id<span class=w> </span><span class=s2>&quot;ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4></a>&gt;<span class=w> </span>--table-name-or-id<span class=w> </span><span class=s2>&quot;pizza&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5></a>&gt;<span class=w> </span>--table-limits<span class=w> </span><span class=s2>&quot;{\&quot;capacityMode\&quot;: \&quot;PROVISIONED\&quot;, \&quot;maxReadUnits\&quot;: 15,\&quot;maxWriteUnits\&quot;: 5, \&quot;maxStorageInGBs\&quot;: 2}&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6></a>&gt;<span class=w> </span>--wait-for-state<span class=w> </span><span class=s2>&quot;SUCCEEDED&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7></a>&gt;<span class=w> </span>--force
</span></code></pre></div></td></tr></table></div> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Para configurar o <code>capacityMode</code> como <code>ON_DEMAND</code>, os parâmetros <code>maxReadUnits</code> e <code>maxWriteUnits</code> devem ser definidos como zero (<code>0</code>), enquanto o parâmetro <code>maxStorageInGBs</code> deve ter um valor inicial superior a zero.</p> </div> <h4 id=leitura-eventual-ou-absoluta><strong>Leitura Eventual ou Absoluta</strong></h4> <p>Ao lidar com dados distribuídos, como em bancos de dados do tipo <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>NoSQL</a>, outros dois conceitos se tornam fundamentais durante o processo de <strong>leitura dos dados</strong> que são:</p> <ul> <li> <p><strong>Consistência de Leitura Eventual</strong></p> <ul> <li>Isso indica que os dados retornados de uma operação de leitura podem não ser os mais recentemente gravados.</li> <li>Para uma melhor compreensão, imagine que uma operação de escrita foi recentemente executada (inserção, atualização ou exclusão). Os dados dessa operação precisam ser replicados em todos os nós do cluster para garantir a consistência das informações. O tempo necessário para essa replicação pode impactar a consistência das leituras e, dependendo das exigências do seu negócio, essa latência pode ser aceitável e é denominada <strong>consistência eventual</strong> ou <strong>eventualmente consistente</strong>.</li> </ul> </li> <li> <p><strong>Consistência de Leitura Absoluta</strong></p> <ul> <li>Os dados retornados a partir de uma operação de leitura, são os mais recentes gravados.</li> <li>Nesse caso, uma operação de leitura é realizada em vários nós do cluster para comparar a consistência dos dados e retornar o registro mais recentemente gravado.</li> </ul> </li> </ul> <p>Por meio das APIs do <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>Oracle NoSQL</a> é possível especificar o tipo de leitura desejada, seja ela <strong>Eventual</strong> (<code>EVENTUAL</code>) ou <strong>Absoluta</strong> (<code>ABSOLUTE</code>).</p> <p>Por exemplo, o comando abaixo realiza uma <strong>Leitura Absoluta</strong> através do parâmetro <code>--consistency "ABSOLUTE"</code>:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-5-1> 1</a></span>
<span class=normal><a href=#__codelineno-5-2> 2</a></span>
<span class=normal><a href=#__codelineno-5-3> 3</a></span>
<span class=normal><a href=#__codelineno-5-4> 4</a></span>
<span class=normal><a href=#__codelineno-5-5> 5</a></span>
<span class=normal><a href=#__codelineno-5-6> 6</a></span>
<span class=normal><a href=#__codelineno-5-7> 7</a></span>
<span class=normal><a href=#__codelineno-5-8> 8</a></span>
<span class=normal><a href=#__codelineno-5-9> 9</a></span>
<span class=normal><a href=#__codelineno-5-10>10</a></span>
<span class=normal><a href=#__codelineno-5-11>11</a></span>
<span class=normal><a href=#__codelineno-5-12>12</a></span>
<span class=normal><a href=#__codelineno-5-13>13</a></span>
<span class=normal><a href=#__codelineno-5-14>14</a></span>
<span class=normal><a href=#__codelineno-5-15>15</a></span>
<span class=normal><a href=#__codelineno-5-16>16</a></span>
<span class=normal><a href=#__codelineno-5-17>17</a></span>
<span class=normal><a href=#__codelineno-5-18>18</a></span>
<span class=normal><a href=#__codelineno-5-19>19</a></span>
<span class=normal><a href=#__codelineno-5-20>20</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1></a>$<span class=w> </span>oci<span class=w> </span>nosql<span class=w> </span>query<span class=w> </span>execute<span class=w> </span><span class=se>\</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2></a>&gt;<span class=w> </span>--region<span class=w> </span><span class=s2>&quot;sa-saopaulo-1&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3></a>&gt;<span class=w> </span>--compartment-id<span class=w> </span><span class=s2>&quot;ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4></a>&gt;<span class=w> </span>--consistency<span class=w> </span><span class=s2>&quot;ABSOLUTE&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5></a>&gt;<span class=w> </span>--statement<span class=w> </span><span class=s2>&quot;SELECT name, email, telephone FROM user WHERE email=&#39;rita.cassia@ocipizza.com.br&#39;&quot;</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6></a><span class=o>{</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7></a><span class=w>  </span><span class=s2>&quot;data&quot;</span>:<span class=w> </span><span class=o>{</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8></a><span class=w>    </span><span class=s2>&quot;items&quot;</span>:<span class=w> </span><span class=o>[</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9></a><span class=w>      </span><span class=o>{</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10></a><span class=w>        </span><span class=s2>&quot;email&quot;</span>:<span class=w> </span><span class=s2>&quot;rita.cassia@ocipizza.com.br&quot;</span>,
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11></a><span class=w>        </span><span class=s2>&quot;name&quot;</span>:<span class=w> </span><span class=s2>&quot;Rita de Cássia&quot;</span>,
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12></a><span class=w>        </span><span class=s2>&quot;telephone&quot;</span>:<span class=w> </span><span class=s2>&quot;16999999999&quot;</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13></a><span class=w>      </span><span class=o>}</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14></a><span class=w>    </span><span class=o>]</span>,
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15></a><span class=w>    </span><span class=s2>&quot;usage&quot;</span>:<span class=w> </span><span class=o>{</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16></a><span class=w>      </span><span class=s2>&quot;read-units-consumed&quot;</span>:<span class=w> </span><span class=m>20</span>,
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17></a><span class=w>      </span><span class=s2>&quot;write-units-consumed&quot;</span>:<span class=w> </span><span class=m>0</span>
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18></a><span class=w>    </span><span class=o>}</span>
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19></a><span class=w>  </span><span class=o>}</span>
</span><span id=__span-5-20><a id=__codelineno-5-20 name=__codelineno-5-20></a><span class=o>}</span>
</span></code></pre></div></td></tr></table></div> <h3 id=hierarquias-de-tabelas><strong><a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-hierarchies.html target=_blank>Hierarquias de Tabelas</a></strong></h3> <p>O <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>Oracle NoSQL</a> permite criar <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabelas</a> que seguem um relacionamento <strong><em>pai-filho</em></strong>. Isso é conhecido como <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-hierarchies.html target=_blank>Hierarquias de Tabelas</a>. </p> <p><a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-hierarchies.html target=_blank>Hierarquias de Tabelas</a> são uma forma de estabelecer relações de dados do tipo <strong>1 para N</strong> entre uma ou mais <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabelas</a>, funcionando de maneira semelhante às chaves estrangeiras (<code>FOREIGN KEY</code>) que conectam duas ou mais tabelas em bancos de dados relacionais.</p> <p>Por exemplo, na aplicação <strong>OCI PIZZA</strong>, existe um relacionamento <strong>pai-filho</strong> entre a tabela <strong>user</strong> e a tabela <strong>order</strong>, formando assim a relação <strong>user.order</strong>.</p> <p><img alt=alt_text src=../img/nosql-table-hierarchies-user-order-1.png title="User.Order #1"></p> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>O <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>Oracle NoSQL</a> utiliza a notação de ponto entre os nomes das tabelas para representar os relacionamentos entre elas.</p> </div> <p>A <strong>tabela filha</strong>, ou <strong>Child Table</strong>, herda as colunas da chave primária de sua tabela pai, além das propriedades relacionadas ao total de armazenamento, unidades de escrita e leitura. </p> <p>Por exemplo, a seguinte instrução <code>SELECT</code> demonstra como um <code>JOIN</code> no <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>Oracle NoSQL</a> pode ser usado para recuperar todos os pedidos de pizzas feitos pela usuária <strong>"Rita de Cássia"</strong> na aplicação <strong>OCI PIZZA</strong>:</p> <div class="language-sql highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-6-1>1</a></span>
<span class=normal><a href=#__codelineno-6-2>2</a></span>
<span class=normal><a href=#__codelineno-6-3>3</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>email</span><span class=p>,</span><span class=w> </span><span class=n>telephone</span><span class=p>,</span><span class=w> </span><span class=n>pizza</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>User</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2></a><span class=w>    </span><span class=k>LEFT</span><span class=w> </span><span class=k>OUTER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=k>user</span><span class=p>.</span><span class=k>order</span><span class=w> </span><span class=n>UserOrder</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>User</span><span class=p>.</span><span class=n>id</span><span class=o>=</span><span class=n>UserOrder</span><span class=p>.</span><span class=n>id</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3></a><span class=k>WHERE</span><span class=w> </span><span class=k>User</span><span class=p>.</span><span class=n>name</span><span class=o>=</span><span class=ss>&quot;Rita de Cássia&quot;</span>
</span></code></pre></div></td></tr></table></div> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Consulte o link <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/nsdev/overview-left-outer-joins.html target=_blank><i>"Overview of Left Outer Joins"</i></a> para maiores informações sobre a instrução <code>LEFT OUTER JOIN</code>.</p> </div> <h3 id=global-active-tables><strong><a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/gasnd/index.html target=_blank>Global Active Tables</a></strong></h3> <p>O <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/gasnd/index.html target=_blank>Global Active Tables</a> é uma funcionalidade do <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>Oracle NoSQL</a> que permite a replicação de dados de <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabelas</a> de forma transparente entre as <a href=../../capitulo-3/introducao-ao-oci/#311-região>regiões</a> do <a href=../../capitulo-3/introducao-ao-oci/ >OCI</a>. Isso significa que os dados escritos ou atualizados em uma <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabela</a> em uma <a href=../../capitulo-3/introducao-ao-oci/#311-região>região</a> específica, são automaticamente replicados para outras <a href=../../capitulo-3/introducao-ao-oci/#311-região>regiões</a> que fazem parte do esquema de replicação.</p> <p>Essa funcionalidade é útil, pois possibilita a execução simultânea de aplicações em diferentes <a href=../../capitulo-3/introducao-ao-oci/#311-região>regiões</a> <strong>(modo ativo-ativo)</strong>. Um exemplo disso é a aplicação <strong>OCI PIZZA</strong>, que opera simultaneamente nas <a href=../../capitulo-3/introducao-ao-oci/#311-região>regiões</a> <strong>sa-saopaulo-1</strong> e <strong>sa-vinhedo-1</strong>. Além disso, oferece tolerância a falhas em caso de indisponibilidade de uma <a href=../../capitulo-3/introducao-ao-oci/#311-região>região</a>.</p> <p>A seguir, estão algumas considerações importantes para ativar o <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/gasnd/index.html target=_blank>Global Active Tables</a>:</p> <h4 id=1-freeze-e-unfreeze><strong>1. Freeze e Unfreeze</strong></h4> <p>O esquema da <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabela</a> deve ser alterado de <strong>Mutável</strong> para <strong>Não Mutável</strong> (<a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/rcgat/index.html target=_blank>FREEZE</a>) usando a instrução <code>ALTER TABLE &lt;tabela&gt; FREEZE SCHEMA FORCE</code>. Essa ação é necessária para evitar qualquer modificação no esquema da <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabela</a> replicada e pode ser executada com o seguinte comando:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-7-1>1</a></span>
<span class=normal><a href=#__codelineno-7-2>2</a></span>
<span class=normal><a href=#__codelineno-7-3>3</a></span>
<span class=normal><a href=#__codelineno-7-4>4</a></span>
<span class=normal><a href=#__codelineno-7-5>5</a></span>
<span class=normal><a href=#__codelineno-7-6>6</a></span>
<span class=normal><a href=#__codelineno-7-7>7</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1></a>$<span class=w> </span>oci<span class=w> </span>nosql<span class=w> </span>table<span class=w> </span>update<span class=w> </span><span class=se>\</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2></a>&gt;<span class=w> </span>--region<span class=w> </span><span class=s2>&quot;sa-saopaulo-1&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3></a>&gt;<span class=w> </span>--table-name-or-id<span class=w> </span><span class=s2>&quot;pizza&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4></a>&gt;<span class=w> </span>--compartment-id<span class=w> </span><span class=s2>&quot;ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5></a>&gt;<span class=w> </span>--ddl-statement<span class=w> </span><span class=s2>&quot;ALTER TABLE pizza FREEZE SCHEMA FORCE&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6></a>&gt;<span class=w> </span>--wait-for-state<span class=w> </span><span class=s2>&quot;SUCCEEDED&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7></a>&gt;<span class=w> </span>--force
</span></code></pre></div></td></tr></table></div> <p>Após concluir o <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/rcgat/index.html target=_blank>FREEZE</a> do esquema, é possível configurar a replicação para a <a href=../../capitulo-3/introducao-ao-oci/#311-região>região</a> desejada utilizando o seguinte comando:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-8-1>1</a></span>
<span class=normal><a href=#__codelineno-8-2>2</a></span>
<span class=normal><a href=#__codelineno-8-3>3</a></span>
<span class=normal><a href=#__codelineno-8-4>4</a></span>
<span class=normal><a href=#__codelineno-8-5>5</a></span>
<span class=normal><a href=#__codelineno-8-6>6</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1></a>$<span class=w> </span>oci<span class=w> </span>nosql<span class=w> </span>table<span class=w> </span>create-replica<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2></a>&gt;<span class=w> </span>--region<span class=w> </span><span class=s2>&quot;sa-saopaulo-1&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3></a>&gt;<span class=w> </span>--replica-region<span class=w> </span><span class=s2>&quot;sa-vinhedo-1&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4></a>&gt;<span class=w> </span>--compartment-id<span class=w> </span><span class=s2>&quot;ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5></a>&gt;<span class=w> </span>--table-name-or-id<span class=w> </span><span class=s2>&quot;pizza&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6></a>&gt;<span class=w> </span>--wait-for-state<span class=w> </span><span class=s2>&quot;SUCCEEDED&quot;</span>
</span></code></pre></div></td></tr></table></div> <p>Se for necessário fazer qualquer alteração no esquema, é preciso primeiro remover a réplica e, em seguida, retornar o esquema para <strong>Mutável</strong> (<a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/rcgat/index.html target=_blank>UNFREEZE</a>) usando a instrução <code>ALTER TABLE &lt;tabela&gt; UNFREEZE SCHEMA</code>. </p> <p>Isso pode ser realizado usando a sequência de comandos a seguir:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-9-1>1</a></span>
<span class=normal><a href=#__codelineno-9-2>2</a></span>
<span class=normal><a href=#__codelineno-9-3>3</a></span>
<span class=normal><a href=#__codelineno-9-4>4</a></span>
<span class=normal><a href=#__codelineno-9-5>5</a></span>
<span class=normal><a href=#__codelineno-9-6>6</a></span>
<span class=normal><a href=#__codelineno-9-7>7</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1></a>$<span class=w> </span>oci<span class=w> </span>nosql<span class=w> </span>table<span class=w> </span>delete-replica<span class=w> </span><span class=se>\</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2></a>&gt;<span class=w> </span>--region<span class=w> </span><span class=s2>&quot;sa-saopaulo-1&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3></a>&gt;<span class=w> </span>--replica-region<span class=w> </span><span class=s2>&quot;sa-vinhedo-1&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4></a>&gt;<span class=w> </span>--compartment-id<span class=w> </span><span class=s2>&quot;ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5></a>&gt;<span class=w> </span>--table-name-or-id<span class=w> </span><span class=s2>&quot;pizza&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6></a>&gt;<span class=w> </span>--wait-for-state<span class=w> </span><span class=s2>&quot;SUCCEEDED&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7></a>&gt;<span class=w> </span>--force
</span></code></pre></div></td></tr></table></div> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-10-1>1</a></span>
<span class=normal><a href=#__codelineno-10-2>2</a></span>
<span class=normal><a href=#__codelineno-10-3>3</a></span>
<span class=normal><a href=#__codelineno-10-4>4</a></span>
<span class=normal><a href=#__codelineno-10-5>5</a></span>
<span class=normal><a href=#__codelineno-10-6>6</a></span>
<span class=normal><a href=#__codelineno-10-7>7</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1></a>$<span class=w> </span>oci<span class=w> </span>nosql<span class=w> </span>table<span class=w> </span>update<span class=w> </span><span class=se>\</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2></a>&gt;<span class=w> </span>--region<span class=w> </span><span class=s2>&quot;sa-saopaulo-1&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3></a>&gt;<span class=w> </span>--table-name-or-id<span class=w> </span><span class=s2>&quot;pizza&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4></a>&gt;<span class=w> </span>--compartment-id<span class=w> </span><span class=s2>&quot;ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5></a>&gt;<span class=w> </span>--ddl-statement<span class=w> </span><span class=s2>&quot;ALTER TABLE pizza UNFREEZE SCHEMA&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6></a>&gt;<span class=w> </span>--wait-for-state<span class=w> </span><span class=s2>&quot;SUCCEEDED&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7></a>&gt;<span class=w> </span>--force
</span></code></pre></div></td></tr></table></div> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>O script <a href=https://github.com/daniel-armbrust/ocn-ocipizza/blob/main/scripts/capitulo-4/nosql-replica.sh target=_blank>"nosql-replica.sh"</a>, que é responsável pela criação das réplicas e pelo <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/rcgat/index.html target=_blank>FREEZE</a> dos esquemas das <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabelas</a> da aplicação <strong>OCI PIZZA</strong>, está localizado no diretório <a href=https://github.com/daniel-armbrust/ocn-ocipizza/tree/main/scripts/capitulo-4 target=_blank>"scripts/capitulo-4"</a> do <a href=https://github.com/daniel-armbrust/ocn-ocipizza target=_blank>repositório de códigos</a>.</p> </div> <h4 id=2-colunas-de-identidade><strong>2. Colunas de Identidade</strong></h4> <p><a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/identity-column.html target=_blank>Colunas de identidade (IDENTITY Column)</a> não podem ser utilizadas, pois não é possível garantir a unicidade dos seus valores entre as <a href=../../capitulo-3/introducao-ao-oci/#311-região>regiões</a> que participam do esquema de replicação. Nesse cenário, a responsabilidade pela unicidade dos valores recai sobre a aplicação.</p> <h4 id=3-replicacao-assincrona><strong>3. Replicação Assíncrona</strong></h4> <p>As atualizações das <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabelas</a> que participam do esquema de replicação são realizadas de forma <strong>assíncrona</strong>. Isso significa que, ao executar uma operação de escrita ou atualização de dados em uma <a href=../../capitulo-3/introducao-ao-oci/#311-região>região</a>, essa ação é concluída primeiro nessa <a href=../../capitulo-3/introducao-ao-oci/#311-região>região</a>, antes que os dados sejam replicados para as demais <a href=../../capitulo-3/introducao-ao-oci/#311-região>regiões</a>. </p> <h2 id=424-oracle-nosql-database-python-sdk>4.2.4 Oracle NoSQL Database Python SDK</h2> <p>Existem duas formas para acessar e trabalhar com o <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>Oracle NoSQL</a> em uma aplicação <a href=https://www.python.org/ target=_blank>Python</a>:</p> <h3 id=oci-python-sdk><strong><a href=https://docs.oracle.com/en-us/iaas/Content/API/SDKDocs/pythonsdk.htm target=_blank>OCI Python SDK</a></strong></h3> <p>A forma mais simples de interagir com o <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>Oracle NoSQL</a> é através do <a href=https://docs.oracle.com/en-us/iaas/Content/API/SDKDocs/pythonsdk.htm target=_blank>OCI Python SDK</a>. Nesse modo, o acesso ao serviço é realizado exclusivamente por meio das APIs REST do <a href=../../capitulo-3/introducao-ao-oci/ >OCI</a>. No entanto, essa abordagem não é a mais recomendada para manipular grandes volumes de dados que exigem a execução de consultas mais complexas.</p> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-11-1> 1</a></span>
<span class=normal><a href=#__codelineno-11-2> 2</a></span>
<span class=normal><a href=#__codelineno-11-3> 3</a></span>
<span class=normal><a href=#__codelineno-11-4> 4</a></span>
<span class=normal><a href=#__codelineno-11-5> 5</a></span>
<span class=normal><a href=#__codelineno-11-6> 6</a></span>
<span class=normal><a href=#__codelineno-11-7> 7</a></span>
<span class=normal><a href=#__codelineno-11-8> 8</a></span>
<span class=normal><a href=#__codelineno-11-9> 9</a></span>
<span class=normal><a href=#__codelineno-11-10>10</a></span>
<span class=normal><a href=#__codelineno-11-11>11</a></span>
<span class=normal><a href=#__codelineno-11-12>12</a></span>
<span class=normal><a href=#__codelineno-11-13>13</a></span>
<span class=normal><a href=#__codelineno-11-14>14</a></span>
<span class=normal><a href=#__codelineno-11-15>15</a></span>
<span class=normal><a href=#__codelineno-11-16>16</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1></a><span class=kn>import</span><span class=w> </span><span class=nn>oci</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2></a>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3></a><span class=n>COMPARTMENT_ID</span> <span class=o>=</span> <span class=s1>&#39;ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc&#39;</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4></a>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5></a><span class=n>config</span> <span class=o>=</span> <span class=n>oci</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>from_file</span><span class=p>()</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6></a><span class=n>nosql_client</span> <span class=o>=</span> <span class=n>oci</span><span class=o>.</span><span class=n>nosql</span><span class=o>.</span><span class=n>NosqlClient</span><span class=p>(</span><span class=n>config</span><span class=o>=</span><span class=n>config</span><span class=p>)</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7></a>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8></a><span class=n>query_details</span> <span class=o>=</span> <span class=n>oci</span><span class=o>.</span><span class=n>nosql</span><span class=o>.</span><span class=n>models</span><span class=o>.</span><span class=n>QueryDetails</span><span class=p>(</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9></a>    <span class=n>compartment_id</span><span class=o>=</span><span class=n>COMPARTMENT_ID</span><span class=p>,</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10></a>    <span class=n>consistency</span><span class=o>=</span><span class=s1>&#39;ABSOLUTE&#39;</span><span class=p>,</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11></a>    <span class=n>statement</span><span class=o>=</span><span class=s1>&#39;SELECT name, telephone FROM user WHERE id=1&#39;</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12></a><span class=p>)</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13></a>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14></a><span class=n>resp</span> <span class=o>=</span> <span class=n>nosql_client</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>query_details</span><span class=o>=</span><span class=n>query_details</span><span class=p>)</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15></a>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16></a><span class=nb>print</span><span class=p>(</span><span class=n>resp</span><span class=o>.</span><span class=n>data</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> <p>Consultas mais complexas, como por exemplo a instrução <code>SELECT max(id) FROM user</code>, não são suportadas, resultando em mensagens de exceção como: <code>The driver or SDK being used does not support complex query</code>.</p> <h3 id=oracle-nosql-database-python-sdk-borneo><strong><a href=https://pypi.org/project/borneo/ target=_blank>Oracle NoSQL Database Python SDK (borneo)</a></strong></h3> <p>O <a href=https://pypi.org/project/borneo/ target=_blank>Borneo</a> é um driver para o <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>Oracle NoSQL</a> que utiliza um protocolo binário e que pode ser utlizado para lidar com grandes volumes de dados além de possibilitar a execução de consultas complexas.</p> <p>Além de ser a forma utilizada pela aplicação <strong>OCI PIZZA</strong>, é a opção mais recomendada para interagir com o <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>Oracle NoSQL</a>, tanto no <a href=../../capitulo-3/introducao-ao-oci/ >OCI</a> quanto em instalações on-premises.</p> <p><a href=https://pypi.org/project/borneo/ target=_blank>Borneo</a> requer o <a href=https://docs.oracle.com/en-us/iaas/Content/API/SDKDocs/pythonsdk.htm target=_blank>OCI Python SDK</a>, e ambos podem ser instalados com o comando a seguir:</p> <div class="language-bash highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-12-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1></a><span class=o>(</span>venv<span class=o>)</span><span class=w> </span>$<span class=w> </span>pip<span class=w> </span>install<span class=w> </span>oci<span class=w> </span>borneo
</span></code></pre></div></td></tr></table></div> <p>A utilização do <a href=https://pypi.org/project/borneo/ target=_blank>Borneo</a> requer mais parametrizações no código em comparação ao <a href=https://docs.oracle.com/en-us/iaas/Content/API/SDKDocs/pythonsdk.htm target=_blank>OCI Python SDK</a>. </p> <p>Por exemplo, o código a seguir pode ser utilizado para executar a instrução <code>SELECT max(id) FROM user</code>:</p> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-13-1> 1</a></span>
<span class=normal><a href=#__codelineno-13-2> 2</a></span>
<span class=normal><a href=#__codelineno-13-3> 3</a></span>
<span class=normal><a href=#__codelineno-13-4> 4</a></span>
<span class=normal><a href=#__codelineno-13-5> 5</a></span>
<span class=normal><a href=#__codelineno-13-6> 6</a></span>
<span class=normal><a href=#__codelineno-13-7> 7</a></span>
<span class=normal><a href=#__codelineno-13-8> 8</a></span>
<span class=normal><a href=#__codelineno-13-9> 9</a></span>
<span class=normal><a href=#__codelineno-13-10>10</a></span>
<span class=normal><a href=#__codelineno-13-11>11</a></span>
<span class=normal><a href=#__codelineno-13-12>12</a></span>
<span class=normal><a href=#__codelineno-13-13>13</a></span>
<span class=normal><a href=#__codelineno-13-14>14</a></span>
<span class=normal><a href=#__codelineno-13-15>15</a></span>
<span class=normal><a href=#__codelineno-13-16>16</a></span>
<span class=normal><a href=#__codelineno-13-17>17</a></span>
<span class=normal><a href=#__codelineno-13-18>18</a></span>
<span class=normal><a href=#__codelineno-13-19>19</a></span>
<span class=normal><a href=#__codelineno-13-20>20</a></span>
<span class=normal><a href=#__codelineno-13-21>21</a></span>
<span class=normal><a href=#__codelineno-13-22>22</a></span>
<span class=normal><a href=#__codelineno-13-23>23</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1></a><span class=kn>from</span><span class=w> </span><span class=nn>borneo.iam</span><span class=w> </span><span class=kn>import</span> <span class=n>SignatureProvider</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2></a><span class=kn>from</span><span class=w> </span><span class=nn>borneo</span><span class=w> </span><span class=kn>import</span> <span class=n>NoSQLHandleConfig</span><span class=p>,</span> <span class=n>NoSQLHandle</span><span class=p>,</span> <span class=n>Regions</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3></a><span class=kn>from</span><span class=w> </span><span class=nn>borneo</span><span class=w> </span><span class=kn>import</span> <span class=n>Consistency</span><span class=p>,</span> <span class=n>QueryRequest</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4></a>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5></a><span class=n>COMPARTMENT_ID</span> <span class=o>=</span> <span class=s1>&#39;ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc&#39;</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6></a>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7></a><span class=n>sigprov</span> <span class=o>=</span> <span class=n>SignatureProvider</span><span class=p>(</span><span class=n>config_file</span><span class=o>=</span><span class=s1>&#39;~/.oci/config&#39;</span><span class=p>)</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8></a>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9></a><span class=n>nosql_handle_config</span> <span class=o>=</span> <span class=n>NoSQLHandleConfig</span><span class=p>(</span><span class=n>Regions</span><span class=o>.</span><span class=n>SA_SAOPAULO_1</span><span class=p>)</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10></a><span class=n>nosql_handle_config</span><span class=o>.</span><span class=n>set_authorization_provider</span><span class=p>(</span><span class=n>sigprov</span><span class=p>)</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11></a><span class=n>nosql_handle_config</span><span class=o>.</span><span class=n>set_default_compartment</span><span class=p>(</span><span class=n>COMPARTMENT_ID</span><span class=p>)</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12></a>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13></a><span class=n>nosql_handle</span> <span class=o>=</span> <span class=n>NoSQLHandle</span><span class=p>(</span><span class=n>nosql_handle_config</span><span class=p>)</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14></a>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15></a><span class=n>query_request</span> <span class=o>=</span> <span class=n>QueryRequest</span><span class=p>()</span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16></a><span class=n>query_request</span><span class=o>.</span><span class=n>set_consistency</span><span class=p>(</span><span class=n>Consistency</span><span class=o>.</span><span class=n>ABSOLUTE</span><span class=p>)</span>        
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17></a><span class=n>query_request</span><span class=o>.</span><span class=n>set_statement</span><span class=p>(</span><span class=s1>&#39;SELECT max(id) FROM user&#39;</span><span class=p>)</span>
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18></a>
</span><span id=__span-13-19><a id=__codelineno-13-19 name=__codelineno-13-19></a><span class=n>resp</span> <span class=o>=</span> <span class=n>nosql_handle</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>query_request</span><span class=p>)</span>
</span><span id=__span-13-20><a id=__codelineno-13-20 name=__codelineno-13-20></a>
</span><span id=__span-13-21><a id=__codelineno-13-21 name=__codelineno-13-21></a><span class=n>nosql_handle</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span><span id=__span-13-22><a id=__codelineno-13-22 name=__codelineno-13-22></a>
</span><span id=__span-13-23><a id=__codelineno-13-23 name=__codelineno-13-23></a><span class=nb>print</span><span class=p>(</span><span class=n>resp</span><span class=o>.</span><span class=n>get_results</span><span class=p>())</span>
</span></code></pre></div></td></tr></table></div> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Embora os exemplos usem a linguagem de programação <a href="https://docs.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/25.1/nsdev&id=nosql-python-sdk-git" target=_blank>Python</a>, o <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/nsdev/getting-started-oracle-nosql-database1.html target=_blank>Oracle NoSQL SDK</a> está disponível para várias outras linguagens de programação, como <a href="https://docs.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/25.1/nsdev&id=nosql-java-sdk-git" target=_blank>Java</a>, <a href="https://docs.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/25.1/nsdev&id=nosql-go-sdk-git" target=_blank>Go</a>, <a href="https://docs.oracle.com/pls/topic/lookup?ctx=en/database/other-databases/nosql-database/25.1/nsdev&id=nosql-node-sdk-git" target=_blank>Node.js</a>, entre outras. Para uma lista completa dos SDKs para as diferentes linguagens de programação suportadas, consulte o link <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/nsdev/getting-started-oracle-nosql-database1.html target=_blank><i>"Getting started with Oracle NoSQL Database"</i></a>.</p> </div> <h2 id=425-escrita-ou-atualizacao-condicional>4.2.5 Escrita ou Atualização Condicional</h2> <p>Tanto o <a href=https://docs.oracle.com/en-us/iaas/Content/API/SDKDocs/pythonsdk.htm target=_blank>OCI Python SDK</a> quanto o <a href=https://pypi.org/project/borneo/ target=_blank>Borneo</a> oferecem a funcionalidade de escrita e atualização condicional nos dados das <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabelas</a>.</p> <p>A escrita ou atualização condicional permite, de maneira simples, inserir novos dados ou atualizar os existentes, sem a necessidade de utilizar instruções SQL, como <code>INSERT</code> ou <code>UPDATE</code>. Esse processo é controlado pelos seguintes parâmetros:</p> <ul> <li> <p><code>IF_ABSENT</code></p> <ul> <li>Os novos valores serão inseridos somente se os dados não existirem.</li> </ul> </li> <li> <p><code>IF_PRESENT</code></p> <ul> <li>Os valores serão atualizados apenas se os dados já existirem.</li> </ul> </li> </ul> <p><code>IF_ABSENT</code> e <code>IF_PRESENT</code> realizam verificações na chave primária da <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabelas</a> para determinar se um novo registro deve ser inserido ou se um registro existente deve ser atualizado.</p> <p>Por exemplo, através do <a href=https://docs.oracle.com/en-us/iaas/Content/API/SDKDocs/pythonsdk.htm target=_blank>OCI Python SDK</a>, o novo usuário de nome <strong>Giovanna Armbrust</strong> não será inserido na tabela <code>users</code> pelo fato da chave primária informada já existir (<code>id=3</code>):</p> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-14-1> 1</a></span>
<span class=normal><a href=#__codelineno-14-2> 2</a></span>
<span class=normal><a href=#__codelineno-14-3> 3</a></span>
<span class=normal><a href=#__codelineno-14-4> 4</a></span>
<span class=normal><a href=#__codelineno-14-5> 5</a></span>
<span class=normal><a href=#__codelineno-14-6> 6</a></span>
<span class=normal><a href=#__codelineno-14-7> 7</a></span>
<span class=normal><a href=#__codelineno-14-8> 8</a></span>
<span class=normal><a href=#__codelineno-14-9> 9</a></span>
<span class=normal><a href=#__codelineno-14-10>10</a></span>
<span class=normal><a href=#__codelineno-14-11>11</a></span>
<span class=normal><a href=#__codelineno-14-12>12</a></span>
<span class=normal><a href=#__codelineno-14-13>13</a></span>
<span class=normal><a href=#__codelineno-14-14>14</a></span>
<span class=normal><a href=#__codelineno-14-15>15</a></span>
<span class=normal><a href=#__codelineno-14-16>16</a></span>
<span class=normal><a href=#__codelineno-14-17>17</a></span>
<span class=normal><a href=#__codelineno-14-18>18</a></span>
<span class=normal><a href=#__codelineno-14-19>19</a></span>
<span class=normal><a href=#__codelineno-14-20>20</a></span>
<span class=normal><a href=#__codelineno-14-21>21</a></span>
<span class=normal><a href=#__codelineno-14-22>22</a></span>
<span class=normal><a href=#__codelineno-14-23>23</a></span>
<span class=normal><a href=#__codelineno-14-24>24</a></span>
<span class=normal><a href=#__codelineno-14-25>25</a></span>
<span class=normal><a href=#__codelineno-14-26>26</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1></a><span class=ch>#!/usr/bin/env python3</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2></a>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3></a><span class=kn>import</span><span class=w> </span><span class=nn>oci</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4></a>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5></a><span class=n>COMPARTMENT_ID</span> <span class=o>=</span> <span class=s1>&#39;ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc&#39;</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6></a>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7></a><span class=n>new_user_data</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8></a>    <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span> 
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9></a>    <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;Giovanna Armbrust&#39;</span><span class=p>,</span> 
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10></a>    <span class=s1>&#39;email&#39;</span><span class=p>:</span> <span class=s1>&#39;gi.armbrust@ocipizza.com.br&#39;</span><span class=p>,</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11></a>    <span class=s1>&#39;telephone&#39;</span><span class=p>:</span> <span class=s1>&#39;88777777777&#39;</span>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12></a><span class=p>}</span>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13></a>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14></a><span class=n>config</span> <span class=o>=</span> <span class=n>oci</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>from_file</span><span class=p>(</span><span class=n>file_location</span><span class=o>=</span><span class=s1>&#39;~/.oci/config&#39;</span><span class=p>)</span>
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15></a><span class=n>nosql_client</span> <span class=o>=</span> <span class=n>oci</span><span class=o>.</span><span class=n>nosql</span><span class=o>.</span><span class=n>NosqlClient</span><span class=p>(</span><span class=n>config</span><span class=o>=</span><span class=n>config</span><span class=p>)</span>
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16></a>
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17></a><span class=n>update_row_details</span> <span class=o>=</span> <span class=n>oci</span><span class=o>.</span><span class=n>nosql</span><span class=o>.</span><span class=n>models</span><span class=o>.</span><span class=n>UpdateRowDetails</span><span class=p>(</span>
</span><span id=__span-14-18><a id=__codelineno-14-18 name=__codelineno-14-18></a>    <span class=n>compartment_id</span><span class=o>=</span><span class=n>COMPARTMENT_ID</span><span class=p>,</span>
</span><span id=__span-14-19><a id=__codelineno-14-19 name=__codelineno-14-19></a>    <span class=n>option</span><span class=o>=</span><span class=s1>&#39;IF_ABSENT&#39;</span><span class=p>,</span>
</span><span id=__span-14-20><a id=__codelineno-14-20 name=__codelineno-14-20></a>    <span class=n>value</span><span class=o>=</span><span class=n>new_user_data</span>
</span><span id=__span-14-21><a id=__codelineno-14-21 name=__codelineno-14-21></a><span class=p>)</span>
</span><span id=__span-14-22><a id=__codelineno-14-22 name=__codelineno-14-22></a>
</span><span id=__span-14-23><a id=__codelineno-14-23 name=__codelineno-14-23></a><span class=n>nosql_client</span><span class=o>.</span><span class=n>update_row</span><span class=p>(</span>
</span><span id=__span-14-24><a id=__codelineno-14-24 name=__codelineno-14-24></a>    <span class=n>table_name_or_id</span><span class=o>=</span><span class=s1>&#39;user&#39;</span><span class=p>,</span>
</span><span id=__span-14-25><a id=__codelineno-14-25 name=__codelineno-14-25></a>    <span class=n>update_row_details</span><span class=o>=</span><span class=n>update_row_details</span>
</span><span id=__span-14-26><a id=__codelineno-14-26 name=__codelineno-14-26></a><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> <p>Através do <a href=https://pypi.org/project/borneo/ target=_blank>Oracle NoSQL Database Python SDK (borneo)</a>, o código ficaria:</p> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-15-1> 1</a></span>
<span class=normal><a href=#__codelineno-15-2> 2</a></span>
<span class=normal><a href=#__codelineno-15-3> 3</a></span>
<span class=normal><a href=#__codelineno-15-4> 4</a></span>
<span class=normal><a href=#__codelineno-15-5> 5</a></span>
<span class=normal><a href=#__codelineno-15-6> 6</a></span>
<span class=normal><a href=#__codelineno-15-7> 7</a></span>
<span class=normal><a href=#__codelineno-15-8> 8</a></span>
<span class=normal><a href=#__codelineno-15-9> 9</a></span>
<span class=normal><a href=#__codelineno-15-10>10</a></span>
<span class=normal><a href=#__codelineno-15-11>11</a></span>
<span class=normal><a href=#__codelineno-15-12>12</a></span>
<span class=normal><a href=#__codelineno-15-13>13</a></span>
<span class=normal><a href=#__codelineno-15-14>14</a></span>
<span class=normal><a href=#__codelineno-15-15>15</a></span>
<span class=normal><a href=#__codelineno-15-16>16</a></span>
<span class=normal><a href=#__codelineno-15-17>17</a></span>
<span class=normal><a href=#__codelineno-15-18>18</a></span>
<span class=normal><a href=#__codelineno-15-19>19</a></span>
<span class=normal><a href=#__codelineno-15-20>20</a></span>
<span class=normal><a href=#__codelineno-15-21>21</a></span>
<span class=normal><a href=#__codelineno-15-22>22</a></span>
<span class=normal><a href=#__codelineno-15-23>23</a></span>
<span class=normal><a href=#__codelineno-15-24>24</a></span>
<span class=normal><a href=#__codelineno-15-25>25</a></span>
<span class=normal><a href=#__codelineno-15-26>26</a></span>
<span class=normal><a href=#__codelineno-15-27>27</a></span>
<span class=normal><a href=#__codelineno-15-28>28</a></span>
<span class=normal><a href=#__codelineno-15-29>29</a></span>
<span class=normal><a href=#__codelineno-15-30>30</a></span>
<span class=normal><a href=#__codelineno-15-31>31</a></span>
<span class=normal><a href=#__codelineno-15-32>32</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1></a><span class=ch>#!/usr/bin/env python3</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2></a>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3></a><span class=kn>from</span><span class=w> </span><span class=nn>borneo.iam</span><span class=w> </span><span class=kn>import</span> <span class=n>SignatureProvider</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4></a><span class=kn>from</span><span class=w> </span><span class=nn>borneo</span><span class=w> </span><span class=kn>import</span> <span class=n>NoSQLHandleConfig</span><span class=p>,</span> <span class=n>NoSQLHandle</span><span class=p>,</span> <span class=n>Regions</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5></a><span class=kn>from</span><span class=w> </span><span class=nn>borneo</span><span class=w> </span><span class=kn>import</span> <span class=n>PutRequest</span><span class=p>,</span> <span class=n>PutOption</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6></a>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7></a><span class=n>COMPARTMENT_ID</span> <span class=o>=</span> <span class=s1>&#39;ocid1.compartment.oc1..aaaaaaaaaaaaaaaabbbbbbbbccc&#39;</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8></a>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9></a><span class=n>new_user_data</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10></a>    <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11></a>    <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;Giovanna Armbrust&#39;</span><span class=p>,</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12></a>    <span class=s1>&#39;email&#39;</span><span class=p>:</span> <span class=s1>&#39;gi.armbrust@ocipizza.com.br&#39;</span><span class=p>,</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13></a>    <span class=s1>&#39;telephone&#39;</span><span class=p>:</span> <span class=s1>&#39;88777777777&#39;</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14></a><span class=p>}</span>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15></a>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16></a><span class=n>sigprov</span> <span class=o>=</span> <span class=n>SignatureProvider</span><span class=p>(</span><span class=n>config_file</span><span class=o>=</span><span class=s1>&#39;~/.oci/config&#39;</span><span class=p>)</span>
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17></a>
</span><span id=__span-15-18><a id=__codelineno-15-18 name=__codelineno-15-18></a><span class=n>nosql_handle_config</span> <span class=o>=</span> <span class=n>NoSQLHandleConfig</span><span class=p>(</span><span class=n>Regions</span><span class=o>.</span><span class=n>SA_SAOPAULO_1</span><span class=p>)</span>
</span><span id=__span-15-19><a id=__codelineno-15-19 name=__codelineno-15-19></a><span class=n>nosql_handle_config</span><span class=o>.</span><span class=n>set_authorization_provider</span><span class=p>(</span><span class=n>sigprov</span><span class=p>)</span>
</span><span id=__span-15-20><a id=__codelineno-15-20 name=__codelineno-15-20></a><span class=n>nosql_handle_config</span><span class=o>.</span><span class=n>set_default_compartment</span><span class=p>(</span><span class=n>COMPARTMENT_ID</span><span class=p>)</span>
</span><span id=__span-15-21><a id=__codelineno-15-21 name=__codelineno-15-21></a>
</span><span id=__span-15-22><a id=__codelineno-15-22 name=__codelineno-15-22></a><span class=n>nosql_handle</span> <span class=o>=</span> <span class=n>NoSQLHandle</span><span class=p>(</span><span class=n>nosql_handle_config</span><span class=p>)</span>
</span><span id=__span-15-23><a id=__codelineno-15-23 name=__codelineno-15-23></a>
</span><span id=__span-15-24><a id=__codelineno-15-24 name=__codelineno-15-24></a><span class=n>put_request</span> <span class=o>=</span> <span class=n>PutRequest</span><span class=p>()</span>
</span><span id=__span-15-25><a id=__codelineno-15-25 name=__codelineno-15-25></a><span class=n>put_request</span><span class=o>.</span><span class=n>set_option</span><span class=p>(</span><span class=n>PutOption</span><span class=o>.</span><span class=n>IF_ABSENT</span><span class=p>)</span>
</span><span id=__span-15-26><a id=__codelineno-15-26 name=__codelineno-15-26></a><span class=n>put_request</span><span class=o>.</span><span class=n>set_table_name</span><span class=p>(</span><span class=s1>&#39;user&#39;</span><span class=p>)</span>
</span><span id=__span-15-27><a id=__codelineno-15-27 name=__codelineno-15-27></a><span class=n>put_request</span><span class=o>.</span><span class=n>set_value</span><span class=p>(</span><span class=n>new_user_data</span><span class=p>)</span>
</span><span id=__span-15-28><a id=__codelineno-15-28 name=__codelineno-15-28></a><span class=n>put_request</span><span class=o>.</span><span class=n>set_return_row</span><span class=p>(</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-15-29><a id=__codelineno-15-29 name=__codelineno-15-29></a>
</span><span id=__span-15-30><a id=__codelineno-15-30 name=__codelineno-15-30></a><span class=n>nosql_handle</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>put_request</span><span class=p>)</span>
</span><span id=__span-15-31><a id=__codelineno-15-31 name=__codelineno-15-31></a>
</span><span id=__span-15-32><a id=__codelineno-15-32 name=__codelineno-15-32></a><span class=n>nosql_handle</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></code></pre></div></td></tr></table></div> <div class="admonition note"> <p class=admonition-title>NOTA</p> <p>Os códigos apresentados nos exemplos acima podem ser encontrados no diretório <a href=https://github.com/daniel-armbrust/ocn-ocipizza/tree/main/scripts/capitulo-4 target=_blank>"scripts/capitulo-4"</a> do <a href=https://github.com/daniel-armbrust/ocn-ocipizza target=_blank>repositório de códigos</a> da aplicação <strong>OCI PIZZA</strong>, com os seguintes nomes: <a href=https://github.com/daniel-armbrust/ocn-ocipizza/blob/main/scripts/capitulo-4/nosql-oci-sdk-absent.py target=_blank>"nosql-oci-sdk-absent.py"</a> e <a href=https://github.com/daniel-armbrust/ocn-ocipizza/blob/main/scripts/capitulo-4/nosql-borneo-absent.py target=_blank>"nosql-borneo-absent.py"</a>.</p> </div> <h2 id=426-tabelas-da-aplicacao-oci-pizza>4.2.6 Tabelas da Aplicação OCI PIZZA</h2> <p>A aplicação <strong>OCI PIZZA</strong> utiliza quatro <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabelas</a> do serviço <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/dtddt/ target=_blank>Oracle NoSQL</a>, cujos dados são replicados entre as <a href=../../capitulo-3/introducao-ao-oci/#311-região>regiões</a> <strong>sa-saopaulo-1</strong> e <strong>sa-vinhedo-1</strong> através da funcionalidade <a href=https://docs.oracle.com/en/cloud/paas/nosql-cloud/gasnd/index.html target=_blank>Global Active Tables</a>. </p> <p>Abaixo, segue uma descrição de cada uma das <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabelas</a>:</p> <ul> <li> <p><strong>pizza</strong></p> <ul> <li>Tabela que armazena informações sobre o cardápio de pizzas, incluindo o nome da pizza, uma descrição e o nome do arquivo correspondente à imagem da pizza.</li> <li>O nome do arquivo da imagem corresponde ao arquivo que foi transferido para o <a href=../object-storage/ >Object Storage</a>.</li> </ul> </li> <li> <p><strong>user</strong></p> <ul> <li>Tabela que armazena os usuários da aplicação, incluindo nome, e-mail, senha, telefone e o status de confirmação do cadastro, indicando se o usuário validou seu registro.</li> <li>Cada novo usuário recebe um e-mail com um link para confirmar seu cadastro após a inscrição.</li> </ul> </li> <li> <p><strong>user.order</strong></p> <ul> <li>A tabela <strong>order</strong> é filha da tabela <strong>user</strong> e é utilizada para registrar os pedidos de pizzas feitos pelos usuários (ordens de compra).</li> </ul> </li> <li> <p><strong>email_verification</strong></p> <ul> <li>Tabela de dados temporários utilizada para confirmar o cadastro de novos usuários e para o processo de redefinição de senha.</li> <li>Cada novo usuário recebe um e-mail com um link que contém um token temporário, utilizado para ativar o cadastro. O processo de redefinição de senha segue a mesma lógica.</li> <li>Essa tabela também utiliza a funcionalidade que remove automaticamente registros com mais de um dia de idade (<code>TTL 1 DAYS</code>). Assim, qualquer registro que ultrapassar um dia, será automaticamente excluído pelo serviço.</li> </ul> </li> </ul> <h3 id=criacao-replica-e-dados><strong>Criação, Réplica e Dados</strong></h3> <p>No diretório <a href=https://github.com/daniel-armbrust/ocn-ocipizza/tree/main/scripts/capitulo-4 target=_blank>"scripts/capitulo-4"</a> do <a href=https://github.com/daniel-armbrust/ocn-ocipizza target=_blank>repositório de códigos</a> da aplicação <strong>OCI PIZZA</strong>, você encontrará alguns scripts e um diretório de dados que servem para criar as <a href=https://docs.oracle.com/en/database/other-databases/nosql-database/25.1/sqlreferencefornosql/table-management.html target=_blank>tabelas</a> da aplicação e ativar suas réplicas na região <strong>sa-vinhedo-1</strong>. </p> <p>Abaixo está a descrição de cada um deles:</p> <ul> <li> <p><code>data/</code></p> <ul> <li>Diretório que contém os arquivos <code>pizza.data</code>, <code>user.data</code> e <code>order.data</code>. Esses arquivos contêm um conjunto de dados utilizados para popular as tabelas da aplicação.</li> </ul> </li> <li> <p><code>nosql-tables.sh</code></p> <ul> <li>Script utilizado para criar as tabelas da aplicação no <a href=../../capitulo-3/iam-limites-cotas-e-audit/#compartimentos>compartimento</a> <code>cmp-database</code> do ambiente de produção na região <strong>sa-saopaulo-1</strong>.</li> </ul> </li> <li> <p><code>nosql-replica.sh</code></p> <ul> <li>Script utilizado para criar as réplicas das tabelas na região <strong>sa-vinhedo-1</strong>. É importante notar que as tabelas nessa região serão criadas automaticamente assim que a réplica for ativada, não sendo necessário criá-las antes da ativação.</li> </ul> </li> <li> <p><code>nosql-data.sh</code></p> <ul> <li>Script utilizado para popular as tabelas da aplicação com os arquivos de dados disponíveis no diretório <code>data/</code>.</li> </ul> </li> </ul> <p>Por fim, esses scripts devem ser executados na seguinte ordem:</p> <ol> <li><code>nosql-tables.sh</code></li> <li><code>nosql-replica.sh</code></li> <li><code>nosql-data.sh</code></li> </ol> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 Daniel Armbrust. Todos os direitos reservados. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://www.linkedin.com/in/daniel-armbrust/ target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.path", "navigation.indexes", "navigation.top"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.e71a0d61.min.js></script> </body> </html>